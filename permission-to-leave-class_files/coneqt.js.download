seqta.bootstrap=function(){var a=new Element("div",{id:"container"});tools.isMobileApp||a.adopt(new Element("div",{id:"menu"}).adopt(new Element("div",{id:"userActions"})));var b=new Element("div",{id:"content"}).inject(a);tools.isMobileApp||b.adopt(new Element("h1",{id:"title"}).grab(new Element("span"))),b.adopt(new Element("div",{id:"toolbar",class:"toolbar"}),new Element("div",{id:"main"})),document.body.set("html",""),tools.isMobileApp&&document.body.addClass("mobileApp"),a.inject(document.body),seqta.chrome.ready(),seqta.bootstrap=function(){}},seqta.coneqt.common={postProcessStudents:function(a){a=Array.clone(a);for(var b={},d={},e=null,f=null,g=null,h=0;h<a.length;h++)if(!(e=a[h]).xx_html_extra){if(f="",g="",e.b&&(f+="{B} ",g+="{B} "),e.year?(f+=e.year+" ",g+=e.year.escapeHTML()+" "):(f+="? ",g+="? "),e.rollgroup?(f+=e.rollgroup+" ",g+=e.rollgroup.escapeHTML()+" "):(f+="? ",g+="? "),e.house){if(e.house_colour&&!d[e.house_colour]){if(!b[e.house_colour]){var j=new Color(e.house_colour);0<=j.hex.indexOf("NaN")?d[e.house_colour]=!0:b[e.house_colour]=j.yiqContrast()}d[e.house_colour]||(g+='<span class="coloured" style="background:'+e.house_colour+";color:"+b[e.house_colour]+';">'+e.house.escapeHTML()+"</span> ")}else g+=e.house.escapeHTML()+" ";f+=e.house+" "}else f+="? ",g+="? ";e.campus?(f+=e.campus+" ",g+=e.campus.escapeHTML()+" "):(f+="? ",g+="? "),e.xx_html_extra=g,e.xx_display_extra=f}return a}},seqta.base.MainMenu=new Class({Implements:[Options,Events],Binds:["addItem","postInit","_doPostInit","setPath","updateColours","_render","_selectItem","_backtrack","_toggle"],options:{drawDelay:250,defaultOrder:50},_items:null,_redrawTimer:null,initialize:function(a,b,c){this.setOptions(a),b=document.id(b)||new Element("div",{class:"mainmenu"}).inject(document.body),c=document.id(c)||new Element("button",{class:"mainmenuToggle",html:tools.getIcon("menu")}).inject(document.body),this._items={_element:b,_childEls:new Element("ul")},b.grab(this._items._childEls,"top"),this._items._childEls.addEvents({"click:relay(li)":this._selectItem,"click:relay(.nav > .back)":this._backtrack}),c.addEvent("click",this._toggle),msg.register("menu.path",this.setPath),msg.register("menu.update.colours",this.updateColours)},_doPostInit:function(){this._render();var a=this._items._element.getElements(".active");if(a)for(var b=a.getParent().getParents("ul"),c=0;c<b.length;c++)b[c].scrollTop=0,b[c].addClass("noscroll")},addItem:function(a,b){var c=a.split("/"),d=this._items;window.clearTimeout(this._redrawTimer);for(var e,f=0;f<c.length;f++)if(e=c[f].trim()){var g=null;c.length-1===f&&(g=b.order),c.length-2===f&&(g=b.folderOrder),d[e]||(d[e]={_label:Locale.get("pages."+e)||e,_order:g||void 0,_colourPref:b.colourPref}),f===c.length-1&&(d[e]._label=b.label,d[e]._icon=b.icon),d=d[e]}this._redrawTimer=this._doPostInit.delay(this.options.drawDelay)},setPath:function(a){var b=seqta.chrome.getPageById(a),c=(a=b?b.id:a).split("/"),d=this._items;this._items._element.getElements(".active").removeClass("active");let e=!1;for(var f,g=0;g<c.length;g++)if(f=(f=c[g].trim()).substring(0,f.indexOf("&"))||f){if(!d[f]){if(!e)continue;const a=Object.keys(d).find(a=>d[a]&&d[a][f]);if(!a)continue;f=a,g--}(d=d[f])._element?d._element.addClass("active"):d._preselected=!0,e||(e=!0)}},updateColours:function(){this._items._element.getElements("li[data-colour]").each(function(a){var b=a.get("data-colour"),c="#dddddd",d=user.getPreference(b);c=d&&d.value||c,a.style.setProperty("--item-colour",c)})},_render:function(a,b,c){a=a||this._items,b=b||"",c=c||"",b&&(c=c+"/"+b);var d=a._icon?tools.getIcon(a._icon):seqta.getMenuIcon(c);a===this._items||a._element||(a._element=new Element("li",{class:"item","data-key":b,"data-path":c}),a._preselected&&a._element.addClass("active"),"element"===typeOf(a._label)?a._element.grab(a._label):a._element.grab(new Element("label",{html:(d||"")+a._label||b})));var e=[];for(var f in a)if(Object.prototype.hasOwnProperty.call(a,f)&&!f.startsWith("_")){for(var g=a[f],h=g._label,j=g._order||this.options.defaultOrder,k=-1,l=0;l<e.length&&0>k;l++)e[l].order<j||e[l].order===j&&e[l].label.toLowerCase()<h.toLowerCase()||(k=l);k=0>k?e.length:k,e.splice(k,0,{label:h,order:j,elements:this._render(a[f],f,c)})}for(l=0;l<e.length;l++)e[l]=e[l].elements;if(e.length){var m=!a._element.hasClass("item");a._hasChildren=!0,a._childEls||(a._element.insertAdjacentHTML("beforeend",tools.getIcon("keyboard_arrow_right")),a._element.addClass("hasChildren"),a._childCont=new Element("div",{class:"sub"}).inject(a._element),!m&&a._childCont.adopt(new Element("div",{class:"nav"}).adopt(new Element("div",{class:"back"}).adopt(tools.getIcon("keyboard_arrow_left",!0),new Element("div",{class:"backLabel",text:a._label||b})))),a._childEls=new Element("ul").inject(a._childCont)),a._childEls.adopt(e)}else if(a._colourPref){a._colour="#dddddd";var n=user.getPreference(a._colourPref);a._colour=n&&n.value||a._colour,a._element.style.setProperty("--item-colour",a._colour),a._element.set("data-colour",a._colourPref)}return a._element},_selectItem:function(a,b){if(!document.id(a.target).match(".nav, .back"))if((b=document.id(b)).getParent().getElements(".active").removeClass("active"),b.addClass("active"),b.hasClass("hasChildren"))for(var c=b.getParents("ul"),d=0;d<c.length;d++)c[d].scrollTop=0,c[d].addClass("noscroll");else this.fireEvent("selectLeaf",[b.get("data-key"),b.get("data-path")]),this._toggle()},_backtrack:function(a,b){a.stop();var c=(b=document.id(b)).getParent(".active");c.removeClass("active"),(c=b.getParent(".noscroll")).removeClass("noscroll")},_toggle:function(){$(document.body).toggleClass("menuShown")}}),function(){var a={assessments:"page/marksbook",courses:"page/programme",dashboard:"page/dashboard",documents:"page/documents",folios:"page/folios",forums:"page/forum",goals:"page/studentGoals",messages:"page/direqt_messages",notices:"page/notices",portals:"workspace/portals",settings:"workspace/admin",reports:"page/academic_reports",timetable:"page/timetable",myed:"workspace/myedonline",welcome:"page/welcome",synergetic:"page/synergetic"},b=function(a,c){if(!c||"object"!==typeOf(c)||!a||!a.length)return null;var d=a.shift(),e=c[d]||c[d.split(":")[0]];return d&&e?0===a.length?("string"===typeOf(e)?e:e.icon)||null:b(a,e):null};seqta.getMenuIcon=function(c){if(!c)return null;var d=c.replace(/^\//,"").split("/");if(!d||!d.length)return null;var e=b(d,a);return e?tools.getIcon(e):null}}();var _extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c])Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};!function(){var a=new Class({Implements:Options,options:{defaultPage:"/welcome",tick:1e4,lag:200,googleTMCode:{student:"UA-76172939-2",contact:"UA-76172939-3"}},Binds:["ready","_getSiteSettings","parseHash","registerPage","getContentArea","pageSave","pagePrint","pageReset","_drawMenu","_drawUserActions","_resize","_extractHash","_revertHash","_saveAndChange","_changePage","_loadPage","getPageById","_getURIFirstLast","_modalAdd","_modalRemove","_updateTitle","_setSchoolLogo","_refreshToolbar","_unload","_composeDireqtMessage","_selectMenuItem"],_elContainer:null,_elMenu:null,_elMenuToggle:null,_elUserActions:null,_elContent:null,_elTitle:null,_elToolbar:null,_elMain:null,_menu:null,_pages:null,_modalCount:0,_oldHash:null,_currentPage:null,_currentPageInstance:null,_resizeTimer:null,_siteName:null,initialize:function(a){this.setOptions(a),this._pages=[];var b=function(){dataStore.retrieve("siteSettings",function(a){a["site.name"]&&a["site.name"].value&&(this._siteName=a["site.name"].value)}.bind(this))}.bind(this);msg.register("datastore.preload",b,!0),msg.register("modal.add",this._modalAdd),msg.register("modal.remove",this._modalRemove),msg.register("title.update",this._updateTitle),msg.register("toolbar.refresh",this._refreshToolbar),window.onbeforeunload=this._unload},ready:function(){this._elContainer=document.id("container"),this._elContent=document.id("content"),this._elMain=document.id("main"),this._elToolbar=document.id("toolbar"),ajax.send("branding/load",{logo:!0},this._setSchoolLogo),tools.isMobileApp||(this._elMenu=document.id("menu"),this._elUserActions=document.id("userActions"),this._elTitle=document.id("title").getElement("span"),this._elMenuToggle=new Element("button",{id:"menuToggle",html:tools.getIcon("menu")}).inject(this._elContent),this._drawMenu(),msg.register("user.ready",this._getSiteSettings,!0)),window.onhashchange=this.parseHash,window.onHashChange=this.parseHash;var a=function(){clearTimeout(this._resizeTimer),this._resizeTimer=this._resize.delay(this.options.lag)}.bind(this);window.addEvent("resize",a),tools.analytics.init(this.options.googleTMCode[user.type]),msg.send("chrome.ready")},_getSiteSettings:function(){dataStore.retrieve("siteSettings",this._drawUserActions)},parseHash:function(){var a=this._extractHash();if(a.page!==this._currentPage)if(this._modalCount)this._revertHash();else if(this._currentPageInstance&&this._currentPageInstance.isDirty&&this._currentPageInstance.isDirty()){var b,c=new seqta.ui.SlidePane({compact:!0,onDiscard:this._changePage,onCancel:this._revertHash,onClose:this._revertHash,onSave:this._saveAndChange}),d=[];this._currentPageInstance.save&&d.push("save"),d.push("discard"),b=[d,"cancel"],c.showConfirm(Locale.get("general.unsavedChangesT"),Locale.get("general.unsavedChanges",[b]),b)}else this._changePage(a);else if(this._currentPageInstance&&this._currentPageInstance.getParams&&this._currentPageInstance.setParams){const b=this._currentPageInstance.getParams()||{},c=Object.keys(a||{}),d=Object.keys(b);(c.length!==d.length||c.some(c=>a[c]!==b[c]))&&this._currentPageInstance.setParams(_extends({},a))}},registerPage:function(a,b,c){dbug.log("seqta.chrome.registerPage",a),a.startsWith("/")||(a=`/${a}`);var d={id:a,name:c.label||Locale.get("pages."+a),definition:b,options:c.options};if(this._pages.push(d),tools.isMobileApp||this._menu.addItem(a,c),this._currentPage===a){var e=this._extractHash();this._loadPage(e),this._menu&&this._menu.setPath(a)}this.parseHash()},getContentArea:function(){return this._elMain},pageSave:function(){this._currentPageInstance&&this._currentPageInstance.save&&this._currentPageInstance.save()},pagePrint:function(){this._currentPageInstance&&this._currentPageInstance.print&&this._currentPageInstance.print()},pageReset:function(){this._currentPageInstance&&this._currentPageInstance.reset&&this._currentPageInstance.reset()},_drawMenu:function(){this._menu=new seqta.base.MainMenu({onSelectLeaf:this._selectMenuItem},this._elMenu,this._elMenuToggle)},_drawUserActions:function(a){const b="student"===user.type?"coneqt-s.":"coneqt-p.";var c=new Element("div",{class:"details"});user.userDesc&&c.grab(new Element("div",{class:a[b+"feedback.enabled"]&&"enabled"===a[b+"feedback.enabled"].value?"name short":"name",text:user.userDesc})),user.userMeta&&(user.userMeta.code||user.userMeta.governmentID)&&c.grab(new Element("div",{class:"code",text:(user.userMeta.code||"")+(user.userMeta.code&&user.userMeta.governmentID?" // ":"")+(user.userMeta.governmentID||"")})),seqta.chrome._elUserActions.grab(c),seqta.chrome._elUserActions.grab(new seqta.ui.Button({title:Locale.get("general.logout"),defaultValue:tools.getIcon("chrome/logout"),extraClass:"logout",onClick:seqta.auth.logout}))},_resize:function(){msg.send("chrome.resized",void 0,!0),this._resizeTimer=this._resize.delay(this.options.tick)},_extractHash:function(){var a=window.location.hash||"#";a.startsWith("#")&&(a=a.substr(1));var b=a.indexOf("?"),c=(a.substr(b+1)||"").parseQueryString();return c.page||(c.page=this.options.defaultPage),c},_revertHash:function(){this._oldHash?window.location.hash=this._oldHash:window.history.go(-1);var a=this._extractHash();msg.send("menu.path",a.page)},_saveAndChange:function(){this._currentPageInstance&&this._currentPageInstance.save&&this._currentPageInstance.save(),this._changePage()},_changePage:function(a){a=a&&a.page?a:this._extractHash(),this._currentPage=a.page,this._oldHash=window.location.hash,msg.send("menu.path",a.page),dbug.log("[Page changed]",window.location.hash),this._loadPage(a)},_loadPage:function(a){if(this._currentPage){tools.analytics.pageView(this._currentPage),this._currentPageInstance&&this._currentPageInstance.cleanup&&this._currentPageInstance.cleanup.attempt&&this._currentPageInstance.cleanup.attempt(),this._elMain.getChildren().destroy(),this._elTitle&&this._elTitle.empty(),this._elToolbar.getChildren().destroy();var b=this.getPageById(this._currentPage);const c=b?b.options:{};(b=b&&b.definition)&&"class"===typeOf(b)&&(this._currentPageInstance=new b(c,a,this._currentPage),this._currentPageInstance.draw&&this._currentPageInstance.draw.attempt&&this._currentPageInstance.draw.attempt(),this._updateTitle(),this._refreshToolbar())}},getPageById:function(a){a=a||this._currentPage;for(var b=0;b<this._pages.length;b++)if(this._pages[b].id===a)return this._pages[b];var c=this._getURIFirstLast(a);if(!c)return null;for(var d,e=0;e<this._pages.length;e++)if((d=this._getURIFirstLast(this._pages[e].id))&&d.first===c.first&&d.last===c.last)return this._pages[e];return null},_getURIFirstLast:function(a){var b;if(!a||!a.length)return null;a=a.replace(/^\//,"").split("/"),b={};for(var c=0;c<a.length;c++)!b.first&&a[c].length?b.first=a[c]:b.first&&a[c].length&&(b.last=a[c]);return b},_modalAdd:function(){this._modalCount+=1},_modalRemove:function(){this._modalCount-=1,this._modalCount=Math.max(this._modalCount,0)},_updateTitle:function(a){try{a||(a=this._currentPageInstance.getTitle?this._currentPageInstance.getTitle():this.getPageById().name),this._elTitle&&this._elTitle.set("text",a);var b=Locale.get("general.brandTitle."+user.type).substitute({page:a});document.title=b+(this._siteName?" — "+this._siteName:"")}catch(b){dbug.error("Error updating title for "+this._currentPage+" to "+a+":",b)}},_setSchoolLogo:function(a){a&&a.length&&this._elContainer.grab(new Element("img",{id:"schoolLogo",src:`${Configuration.baseURL}branding?file=${a[0]}`}),"top")},_refreshToolbar:function(){this._elToolbar.getChildren().destroy(),this._currentPageInstance.getToolbar&&this._elToolbar.adopt(this._currentPageInstance.getToolbar())},_unload:function(){return this._currentPageInstance&&this._currentPageInstance.isDirty&&this._currentPageInstance.isDirty()?Locale.get("general.unsavedChanges"):void 0},_composeDireqtMessage:function(){msg.send("coneqtmessage.global.compose",{})},_selectMenuItem:function(a,b){window.location.hash="#?page="+b}});seqta.chrome=new a}(),Locale.define("en-AU","pages",{assessments:"Assessments",closed:"Closed",courses:"Courses",dashboard:"Dashboard",documents:"Documents",folios:"Folios","folios/read":"Browse folios","folios/edit":"Edit my folios",forums:"Forums",goals:"Goals",messages:"Direqt Messages",notices:"Notices",portals:"Portals",settings:"Settings",reports:"Reports",timetable:"Timetable",upcoming:"Upcoming",welcome:"Welcome",myed:"myEdOnline"}),Locale.define("en-AU","general",{brandTitle:{student:"{page} — SEQTA Learn",contact:"{page} — SEQTA Engage"},version:"SEQTA Suite 2015",add:"Add",back:"Back",calendar:"Calendar",del:"Delete",description:"Description",edit:"Edit",nowhere:"nowhere",print:"Print",printTimetable:"Print timetable",saveTooltip:"Save any changes you have made.",selectDate:"Select date",termAbbreviation:"T",unavailable:"Currently unavailable.",weekAbbreviation:"W",wrongPassword:"The password you have entered as your current password is incorrect.",wrongPasswordT:"Incorrect password",detailJumpTo:"Jump to…",detailJumpClose:"Close"}),Locale.define("en-AU","assessments",{assessments:"Assessments",browser:{folios:"My folios",assessments:"My assessment files"},upcomingAnnotated:"You can no longer edit this assessment because it has been annotated by the teacher.",upcomingMarked:"You can no longer edit this assessment because it has been marked by the teacher."}),Locale.define("en-AU","documents",{documents:"Documents",documentMeta:"{size} Uploaded {date}",date:"Date uploaded",noDocuments:"No documents have yet been made available.",search:"Search",size:"File size",title:"Title"}),Locale.define("en-AU","forum",{forums:"Forums",noForums:"No forums have yet been made available."}),Locale.define("en-AU","wispassessment",{edit:"Edit",preview:"Preview",manageWisp:"Manage direct online (WISP) content",submitted:"This direct online (WISP) content is ready for submission. Remember to check this before the due date!",snapshot:function(a){return"Snap "+a},wordCount:function(a,b){if(!a)return"Nothing entered.";var c="";return c+=1<a?a+" words":"1 word",c+=", ",c+=1<b?b+" characters":"1 character"},submitExplanation:"If you submit this snapshot to your teacher, they’ll be able to see your progress.",annotatedExplanation:"This snapshot has been annotated, so you can no longer unsubmit it.",snapshotExplanation:"Snapshots allow you to keep track of your work as you go. You can send snapshots to your teacher before the due date, but your main content is automatically submitted once the due date has passed."}),Locale.define("en-AU","programme",{blank:"There’s no content available for the selected lesson",goTo:"Go to…",today:"Today"}),Locale.define("en-AU","reports",{reports:"Academic reports",terms:"Timetable period",types:"Report type",year:"Year level",file:"Download",noReports:"No academic reports have yet been made available."}),Locale.define("en-AU","portals",{portals:"Portal pages",errorLoadingPortal:"There was an error displaying your Portal."}),Locale.define("en-AU","settings",{password:"Change your password",authentication:{password:"New password",passwordConfirm:"Confirm your new password",currentPassword:"Old password",currentPasswordPlaceholder:"",passwordConfirmPlaceholder:"",passwordWarning:"Warning: Users will be able to use this password to log in. If internal authentication is not required, please leave blank. Passwords must be 8-64 characters in length.",passwordComplexity:"Passwords must be 8-64 characters in length.",passwordComplexityLabel:"Password requirements",passwordStrengthLabel:"Password strength",passwordWarningLabel:"Password warnings",passwordSuggestionsLabel:"Password suggestions",error:{error:"Error!",blankPassword:"Your password cannot be empty.",mismatchedPasswords:"The new passwords you have entered don’t match!",passwordIncorrect:"You entered an incorrect old password",failedPasswordComplexity:"Invalid password"},save:"Save password",savedT:"Successfully updated",saved:"Your password has been updated."},general:"General settings",richContent:"Rich content",audio:{label:"SEQTA should be",enabled:"Noisy",disabled:"Silent"},app:{label:"Mobile apps",connect:"Connect mobile app",url:"Your URL: {url}",username:"Your username: {username}",noemail:"To connect the app, please visit this page on your mobile device.",email:"Your email address: {email}",emailed:"We've sent an email to {email} with instructions for connecting the app."},creatorThemeOverride:"Override theme for rich content"}),Locale.define("en-AU","notices",{noNotices:"No notices have yet been made available.",displayList:"List mode"}),Locale.define("en-AU","timetable",{clickForDetails:"Tap or click on a timetable entry for more details and to colour it",dayTitle:function(a,b){var c="";return c+=a,b&&b.length&&(c+=" (",c+=b,c+=")"),c+=""},notes:{show:"Show event notes",hide:"Hide event notes"},message:"Message the teacher",notesVisible:"Show notes",viewTutorials:"Show tutorials",viewClasses:"Show classes",viewEvents:"Show events",viewSelectorLabeller:function(a){return"all"===a||3===a.length?"Everything":a.length?a.map(a=>"classes"===a?"classes":"tutorials"===a?"tutorials":"events"===a?"events":null).filter(a=>!!a).join(" and ").initialCap():"Nothing"},assessment:function(a,b){return"<span>"+a+" due on "+b+"</span>"},assessmentDue:function(a){return a+" is due! "},tutorialPending:"(Pending)",tutorial:function(a){return"music"===a?"Music lesson":"Tutorial"},your:"Your calendar"}),Locale.define("en-AU","goals",{pageTitle:function(a){return a+" goals"},action:"Action",done:"Done",goal:"Goal",goals:"Goals",overview:"Overview",notes:function(a){return a?a+"’s notes":"My notes"},reallyDeleteRowT:"Really erase goal?",reallyDeleteRow:"Do you really want to erase this goal?",savedT:"Goals saved",saved:"The goals have been successfully saved.",studentNotes:"Student notes",support:"Support",yearly:"Yearly"}),Locale.define("en-AU","folios",{editor:{create:"New",delete:"Delete",reallyDeleteT:function(a){return"Delete "+a.escapeHTML()+"?"},reallyDelete:function(a){return"Do you really want to delete "+a.escapeHTML()+"? This operation cannot be undone!"},importWisp:"Import",unpublished:"Unpublished",forumEnabled:"Allow comments",defaultTitle:"Untitled folio",editPeople:"Edit…",publish:"Publish this folio",published:function(a){return"Published "+a},tags:"Tags",editPeopleLabel:function(a,b,c){var d=0;return a&&(d+=a.length),b&&(d+=b.length),c&&(d+=c.length),1===d?"Visible only to you.":"Visible to "+d+" people."},editPeopleLabelTitle:function(a,b,c){var d=[];return a&&d.push(a.length+" students"),b&&d.push(b.length+" staff"),c&&d.push(c.length+" guardians"),d.join("; ")},people:{title:"Make this folio visible to…"},browser:{folio:"My folios",assessments:"My assessment files"},import:{dialogTitle:"Import which direct online (WISP) content?",snapshotSuffix:"(snapshot)"}}}),Locale.define("en-AU","courses",{courses:"Courses",defaultCurrentTerm:"Default (current timetable period)",defaultCourse:"Select a course...",noOnlineContent:"No online content is available for this lesson.",untitledResource:"(Untitled)",homework:"Homework",outline:"Lesson outline"}),Locale.define("en-AU","synergetic",{error:"There was an error loading this page from Synergetic. Please contact your school for assistance.",page:{absences:"Absences",accommodation:"Accommodation booking",applications:"Applications",contacts:"Contacts",contactus:"Contact us",details:"My details",docs:"Documents",electives:"Electives",events:"Events",excursions:"Excursions",finance:"Finance",interviews:"Interviews",paymentplans:"Payment plans",payments:"Payments",results:"Results",selfassessment:"Self assessment",timetable:"Timetable",intro:"Synergetic Community",managestoredcards:"Manage stored cards"}}),window.global=new seqta.Global,msg.register("datastore.preload",function(){Object.merge(dataStore.data,{subjects:{url:"load/subjects",preload:!0},siteSettings:{url:"load/settings",preload:!0},rooms:{url:"room/get",preload:!1},students:{url:"load/message/people",preload:!1,req:{mode:"student"}},staff:{url:"load/message/people",preload:!1,req:{mode:"staff"}},applications:{url:"applications/list",req:{searchText:"",typeNames:[],statusFilter:"show_enabled"}},contacts:{url:"load/message/people",preload:!1,req:{mode:"contact"}},storage:{url:"storage"}}),msg.send("dataStore.ready")},!0),window.addEvent("domready",function(){window.user=new seqta.base.User({urls:{userSettings:"load/prefs",userSettingsSave:"save/prefs"}}),msg.send("user.ready")}),msg.register("ajax.ready",function(){tools.isMobileApp||msg.register("chrome.ready",()=>{const a=document.querySelector("#content");dataStore.retrieve("siteSettings",function(b){if(a){let e=!0,f=!0,g=!0,h=["coneqt-s.page.assessments","coneqt-p.page.assessments"];for(var c=0;c<h.length;c++)b[h[c]]&&"disabled"===b[h[c]].value&&(e=!1);h=["coneqt-p.assessments.past","coneqt-s.assessments.past"];for(c=0;c<h.length;c++)b[h[c]]&&b[h[c]].value&&(f="disabled"!==b[h[c]].value);h=["coneqt-p.assessments.upcoming","coneqt-s.assessments.upcoming"];for(c=0;c<h.length;c++)b[h[c]]&&b[h[c]].value&&(g="disabled"!==b[h[c]].value);var d=new seqta.base.ComponentWrapper({component:SEQTATeachModules.notifications.ConnectedNotifications,className:"connectedNotificationsWrapper",props:{urls:{dismiss:"notification/dismiss"},hrefs:{coneqtassessments:a=>{var c=a.coneqtAssessments||{};const d=c.studentID,h=c.termID,i=c.upcoming,j=c.programmeID,k=c.metaclassID,l=c.assessmentID,m=d?`${d}/`:"";if(e&&g&&i)return`#?page=/assessments/${m}upcoming${"contact"===user.type?":"+d:""}`+(l?`&item=${l}`:"");if(e&&(f||g)){return`#?page=/assessments/${m}${h?`${h}/`:""}${j}:${k}${"contact"===user.type?":"+d:""}`+(l?`&item=${l}`:"")}},message:()=>"#?page=/messages",folio:a=>{let b=a.folio;return`#?page=/folios${"student"===user.type?"/read":""}&id=${b.folioID}`},forum:a=>{return`#?page=/forums/${a.forum.forumID}`},goals:a=>{let b=a.goals;return`#?page=/goals/${b.studentID}/${b.year}:${b.studentID}`},report:a=>{let b=a.report;return`#?page=/reports${"contact"===user.type?"/:"+b.studentID:""}`},timetable:()=>"#?page=/timetable",tutorial:()=>"#?page=/timetable",invite:()=>"#?page=/timetable",reply:()=>"#?page=/timetable"}}});$(d).inject(a),SEQTATeachModules.store.dispatch(SEQTATeachModules.notifications.actions.heartbeat())}})},!0)}),msg.register("login.authenticated",function(){msg.register("datastore.preload",function(){dataStore.retrieve("siteSettings",function(a){var b="student"===user.type?"coneqt-s.":"coneqt-p.";a[b+"feedback.enabled"]&&"disabled"===a[b+"feedback.enabled"].value||(seqta.feedback=new seqta.base.Feedback({container:"#userActions"}))})})}),seqta.coneqt.part.assessments={},window.addEvent("domready",function(){var b;b="student"===(document.body.get("data-type")||"student")?"/images/logo-learn.svg":"/images/logo-engage.svg",seqta.auth=new seqta.base.Authentication({posters:void 0,productImage:b})}),seqta.coneqt.dashlet.Links=new Class({Implements:[Options,Events],options:{urls:{load:"dashlet/links"}},Binds:["toElement","getTitle","_draw","_receiveData"],_data:null,_element:null,initialize:function(a){this.setOptions(a),this._element=new Element("div",{class:"dashlet-links"}),this._draw()},toElement:function(){return this._element},getTitle:function(){return Locale.get("dashlet.links.title")},_draw:function(){ajax.send(this.options.urls.load,{},this._receiveData)},_receiveData:function(a){if(this._data=a,this._data.links&&this._data.links.length)for(var b,c=0;c<this._data.links.length;c++)(b=this._data.links[c]).href&&b.label&&this._element.adopt(new Element("a",{target:"_blank",href:b.href,text:b.label}))}}),seqta.coneqt.dashlet.Pastoral=new Class({Implements:[Options,Events],options:{urls:{load:"dashlet/pastoral"},student:void 0,studentName:"",defaultMode:"month",viewRanges:[{id:"month",label:Locale.get("dashlet.pastoral.oneMonth")},{id:"threeMonths",label:Locale.get("dashlet.pastoral.threeMonth")},{id:"year",label:Locale.get("dashlet.pastoral.lastYear")},{id:"all",label:Locale.get("dashlet.pastoral.allTime")}]},Binds:["toElement","getTitle","_draw","_loadData","_changeMode","_receiveData","_drawPastoral","_drawNote"],_actionsBar:null,_element:null,_elHeader:null,_elPastoral:null,_viewOptions:null,_currentSelection:null,_data:null,initialize:function(a,b){this.setOptions(a),this._element=new Element("div",{class:"dashlet-pastoral"}),this._actionsBar=b||new Element("div"),this._draw()},toElement:function(){return this._element},getTitle:function(){return Locale.get("dashlet.pastoral.title",this.options.studentName)},_draw:function(){this._viewOptions=this._viewOptions||new seqta.ui.Combobox({items:this.options.viewRanges,defaultValue:this.options.defaultMode,onChange:this._changeMode}),this._actionsBar.grab(this._viewOptions),this._elPastoral=new Element("div",{class:"items"}),this._elHeader=new Element("table",{class:"heading"}).grab(new Element("thead").grab(new Element("tr").adopt(new Element("td",{class:"date",text:Locale.get("dashlet.pastoral.date")}),new Element("td",{text:Locale.get("dashlet.pastoral.details")})))),this._changeMode(this.options.defaultMode)},_receiveData:function(a){this._data=a,this._element.getChildren().dispose(),this._drawPastoral()},_changeMode:function(a){var b=Array.convert(a)[0];if(this._currentSelection!==b){var c=new Date;switch(b){case"threeMonths":c.addMonths(-3);break;case"year":c.addMonths(-12);break;case"all":c.setFullYear(1970,0,1);break;case"month":c.addMonths(-1);break;default:return}this._currentSelection=b,ajax.send(this.options.urls.load,{student:this.options.student,from:c.print("sqlDate"),to:(new Date).print("sqlDate")},this._receiveData)}},_drawPastoral:function(){if(this._data&&this._data.length){this._elPastoral.getChildren().dispose();var a=new Element("table");new Element("tbody").inject(a).adopt(this._data.map(this._drawNote)),this._elPastoral.grab(a),this._element.adopt(this._elHeader,this._elPastoral)}else this._element.grab(new Element("div",{class:"note",text:Locale.get("dashlet.pastoral.noneFound")}))},_drawNote:function(a){var b=[],c=new Element("div",{class:"type",text:a.category||""}),d=a.subcategory&&a.subcategory.trim()?new Element("div",{class:"tag",text:"("+a.subcategory+")"}):null,e=new Element("div",{class:"details",text:a.details||""}),f=a.staff?new Element("div",{class:"staff",text:a.staff}):null,g=a.from?a.from.toDate().print("default"):"",h=g&&a.until?" - "+a.until.toDate().print("default"):"";return b.push(new Element("td",{class:"date",text:g+h})),b.push(new Element("td").adopt(c,d,e,f)),new Element("tr").adopt(b)}}),seqta.coneqt.dashlet.SummaryAbsence=new Class({Implements:[Options,Events],options:{urls:{load:"dashlet/summary/absence"},student:void 0,studentName:""},Binds:["toElement","getTitle","_draw","_receiveData","_drawAbsences"],_element:null,_data:null,initialize:function(a){this.setOptions(a),this._element=new Element("div",{class:"dashlet-summary dashlet-summary-absence"}),this._draw()},toElement:function(){return this._element},getTitle:function(){return Locale.get("dashlet.summary-absence.title",this.options.studentName)},_draw:function(){ajax.send(this.options.urls.load,{student:this.options.student},this._receiveData)},_receiveData:function(a){this._data=a,this._element.adopt(this._drawAbsences())},_drawAbsences:function(){for(var a=new Element("table"),b=new Element("tbody").inject(a),c=0;c<this._data.length;c++){var d=this._data[c],e=new Element("tr").inject(b),f=new Element("td",{class:"date",html:d.date.toDate().print()}).inject(e);f=new Element("td",{class:"periods"}).inject(e);for(var g=[],h=0;h<d.data.length;h++)g.push(new Element("span",{class:"period",text:d.data[h]}));f.adopt(g)}return new Element("div",{class:"summary"}).grab(a)}}),seqta.coneqt.dashlet.SummaryHomework=new Class({Implements:[Options,Events],options:{urls:{load:"dashlet/summary/homework"},student:void 0,studentName:""},Binds:["toElement","getTitle","_draw","_receiveData","_drawHomework","_drawSubject","_drawItem"],_element:null,_data:null,initialize:function(a){this.setOptions(a),this._element=new Element("div",{class:"dashlet-summary dashlet-summary-homework"}),this._draw()},toElement:function(){return this._element},getTitle:function(){return Locale.get("dashlet.summary-homework.title",this.options.studentName)},_draw:function(){ajax.send(this.options.urls.load,{student:this.options.student},this._receiveData)},_receiveData:function(a){this._data=a,this._element.adopt(this._drawHomework())},_drawHomework:function(){var a=new Element("div",{class:"summary",events:{"click:relay(.todo)":this._addTask}});return a.adopt(this._data.map(this._drawSubject)),a},_drawSubject:function(a){var b=new Element("div",{class:"subject","data-title":a.title});return b.adopt(new Element("div",{class:"title",text:a.title}),a.items.map(this._drawItem)),b},_drawItem:function(a){var b=new Element("div",{class:"item"});return b.adopt(new Element("div",{class:"content",text:a}),new Element("div",{class:"todo",html:Locale.get("dashlet.summary-homework.todo")})),b},_addTask:function(a,b){b=document.id(b);var c=new Element("div",{html:b.getParent(".item > .content").get("text").nl2p()}).grab(new Element("h2",{text:b.getParent(".subject[data-title]").get("data-title")}),"top");msg.send("dashlet.tasks.add",c.get("html"),!1,!0)}}),seqta.coneqt.dashlet.SummaryPastoral=new Class({Implements:[Options,Events],options:{lowColour:"#fff",highColour:"#c44",urls:{load:"dashlet/summary/pastoral"},student:void 0,studentName:"",mode:"count"},Binds:["toElement","getTitle","_draw","_receiveData","_drawSummary","_drawStepLevel"],_element:null,_stepLevel:null,_summary:null,_actionsBar:null,_showModeToggle:null,_lowColour:null,_highColour:null,_data:null,initialize:function(a,b){this.setOptions(a),this._actionsBar=b||new Element("div"),this._element=new Element("div",{class:"dashlet-summary dashlet-summary-pastoral"}),this._lowColour=new Color(this.options.lowColour),this._highColour=this.options.highColour,this._draw()},toElement:function(){return this._element},getTitle:function(){return Locale.get("dashlet.summary-pastoral.title",this.options.studentName)},_draw:function(){this._modeToggle=this._modeToggle||new seqta.ui.Pillbox({onChange:this._drawSummary},{count:Locale.get("dashlet.summary-pastoral.showCount"),points:Locale.get("dashlet.summary-pastoral.showPoints")},this.options.mode),this._actionsBar.grab(this._modeToggle),ajax.send(this.options.urls.load,{student:this.options.student},this._receiveData)},_receiveData:function(a){this._data=a,this._stepLevel=this._stepLevel||new Element("div",{class:"steplevel"}),this._summary=this._summary||new Element("div",{class:"summary"}),this._element.adopt(this._summary,this._stepLevel),this._drawStepLevel(),this._drawSummary()},_drawSummary:function(a){var b,c,d,e,f,g,h,k,l,m,n,o,p,q;l=this._data.min,m=this._data.min_points,n=(this._data.max-this._data.min)/100;var r=(this._data.max_points-this._data.min_points)/100;this._summary.getChildren().destroy(),b=new Element("table",{class:"header"}),c=new Element("table"),d=new Element("table",{class:"footer"}),e=new Element("thead").inject(b),f=new Element("tbody").inject(c),g=new Element("tfoot").inject(d),h=new Element("tr").inject(e),k=new Element("td",{class:"label"}).inject(h);for(var s=0;12>s;s++)k=new Element("td",{html:Locale.get("date.mnM")[s].substr(0,1)}).inject(h);k=new Element("td",{class:"total",html:Locale.get("dashlet.summary-pastoral.totalShort")}).inject(h),tools.scrollWidth&&(k=new Element("td",{class:"scrollspacer"}).inject(h).grab(new Element("div",{styles:{width:tools.scrollWidth}}))),q=[];for(s=0;s<this._data.summary.length;s++){if(o=this._data.summary[s],p=0,h=new Element("tr").inject(f),k=new Element("td",{class:"label",text:o.label}).inject(h),"points"===a)for(var t=0;t<o.points.length&&12>t;t++)k=new Element("td",{text:o.points[t]}).inject(h),r&&"-"!==o.points[t]&&k.setStyle("background-color",this._lowColour.mix(this._highColour,(o.points[t]-m)/r).rgbToHex()),"-"===o.points[t]?(k.addClass("zero"),q[t]=q[t]||0):(p+=o.points[t].toInt(),q[t]=(q[t]||0)+o.points[t].toInt());else for(t=0;t<o.data.length&&12>t;t++)k=new Element("td",{text:o.data[t]}).inject(h),n&&k.setStyle("background-color",this._lowColour.mix(this._highColour,(o.data[t]-l)/n).rgbToHex()),o.data[t]||k.addClass("zero"),p+=o.data[t],q[t]=(q[t]||0)+o.data[t];k=new Element("td",{class:"total",text:p}).inject(h)}h=new Element("tr").inject(g),k=new Element("td",{class:"label",html:Locale.get("dashlet.summary-pastoral.total")}).inject(h),p=0;for(s=0;s<q.length&&12>s;s++)k=new Element("td",{text:q[s]}).inject(h),p+=q[s];k=new Element("td",{text:p}).inject(h),tools.scrollWidth&&(k=new Element("td",{class:"scrollspacer"}).inject(h).grab(new Element("div",{styles:{width:tools.scrollWidth}}))),this._summary.adopt(b,new Element("div",{class:"tableWrapper"}).grab(c),d)},_drawStepLevel:function(){this._data.step||0===this._data.step||this._data.level||0===this._data.level?this._stepLevel.set("html",Locale.get("dashlet.summary-pastoral.stepLevel",[this._data.step,this._data.level])).show():this._stepLevel.hide()}}),seqta.coneqt.dashlet.Timetable=new Class({Implements:[Options,Events],options:{defaultColour:"#444444",student:void 0,studentName:"",urls:{load:"dashlet/timetable",events:"events/load"}},Binds:["toElement","getTitle","_draw","_retrieveData","_receiveData","_process","cleanup","_partialCleanup","_drawEventEntry","_drawClassEntry","_drawTutorialEntry","_navigate"],_data:null,_events:null,_redrawCleaners:null,_finaliseCleaners:null,_element:null,_days:[],_scale:null,initialize:function(a){this.setOptions(a),this._element=new Element("div",{class:"dashlet-timetable"}),this._scale=0,user.getPreference("calendar.scale")&&(this._scale=user.getPreference("calendar.scale").value),this._days.push(new Date),this._days.push((new Date).addDays(1)),this._redrawCleaners=[],this._finaliseCleaners=[],this._finaliseCleaners.push(msg.register("calendar.cleaner",this._redrawCleaners.push.bind(this._redrawCleaners),!1,!0)),this._draw()},toElement:function(){return this._element},getTitle:function(){return Locale.get("dashlet.timetable.title",this.options.studentName)},_draw:function(){this._calendar||(this._calendar=new seqta.ui.DailyCalendar({onNavigate:this._navigate,onScale:this._draw,highlightWeekends:!0,readonly:!0,showCurrentTime:!0,showStaff:!1,addSpacer:!1,currentScale:this._scale.toInt()},this._days),this._element.adopt(this._calendar),this._calendar.scrollToDefault()),this._retrieveData()},cleanup:function(){this._partialCleanup(),this._finaliseCleaners.forEach(function(a){"function"==typeof a&&a()}),delete this._finaliseCleaners,delete this._redrawCleaners,this._calendar&&this._calendar.cleanup()},_partialCleanup:function(){this._redrawCleaners.forEach(function(a){"function"==typeof a&&a()}),this._redrawCleaners.empty()},_retrieveData:function(){var a=tools.func.createConcurrentHandler(["timetable","events"],this._receiveData);ajax.send(this.options.urls.load,{from:this._days[0].print("sqlDate"),until:this._days[1].print("sqlDate"),student:this.options.student},a.timetable),ajax.send(this.options.urls.events,{dateFrom:this._days[0].print("sqlDate"),dateTo:this._days[1].print("sqlDate"),person:this.options.student||user.userID,personType:"student"},a.events)},_receiveData:function(a,b){this._data=a,this._events=b,this._calendar.setDays(this._days),this._process()},_process:function(){this._partialCleanup(),this._calendar.clearEntries(),this._data.forEach(function(a){"class"===a.type?this._drawClassEntry(a):"tutorial"===a.type&&this._drawTutorialEntry(a)}.bind(this)),this._events.map(this._drawEventEntry),this._redrawCleaners.push(msg.register("calendar.event.updated.new",tools.func.compose(this._drawEventEntry,this._removeNewEntry),!1,!0))},_drawEventEntry:function(a){return new seqta.base.part.calendar.entry.Event({dateRange:[this._days[0].print("sqlDate"),this._days[1].print("sqlDate")],mutable:!1,person:{id:this.options.student||user.userID,type:"student"}},this._calendar,a)},_drawClassEntry:function(a){return new seqta.coneqt.part.timetable.entry.Class({inviteeTypes:this._inviteeTypes},this._calendar,a,this._student)},_drawTutorialEntry:function(a){return new seqta.coneqt.part.timetable.entry.Tutorial({inviteeTypes:this._inviteeTypes},this._calendar,a,this._student)},_navigate:function(a){"back"===a?(this._days[0].addDays(-2),this._days[1].addDays(-2)):"forward"===a&&(this._days[0].addDays(2),this._days[1].addDays(2)),this._draw()}});var _slicedToArray=function(){return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return function(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();seqta.coneqt.page.assessments={},msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){for(var b=!0,c=!0,d=["coneqt-s.page.assessments","coneqt-p.page.assessments"],e=0;e<d.length;e++)if(a[d[e]]&&"disabled"===a[d[e]].value)return;d=["coneqt-p.assessments.past","coneqt-s.assessments.past"];for(e=0;e<d.length;e++)a[d[e]]&&a[d[e]].value&&(b="disabled"!==a[d[e]].value);d=["coneqt-p.assessments.upcoming","coneqt-s.assessments.upcoming"];for(e=0;e<d.length;e++)a[d[e]]&&a[d[e]].value&&(c="disabled"!==a[d[e]].value);(b||c)&&msg.register("user.settings.loaded",function(){dataStore.retrieve("subjects",function(a){var b=function(a,b,c,e){var f=a;b.active||(f=f+b.code+"/");for(var g=0;g<b.subjects.length;g++)d(f,b.subjects[g],b.active,c,e)},d=function(a,b,d,e,f){var g=a+b.programme+":"+b.metaclass;f&&(g=g+":"+f);const h="timetable.subject.colour."+(f?f+".":"")+b.code;seqta.chrome.registerPage(g,seqta.coneqt.page.assessments.Viewer,{label:b.title,order:50,folderOrder:d?50:99+e,colourPref:h,options:{enabledUpcoming:c,colourPref:user.getPreference(h)}})},e="/assessments/";if("contact"===user.type)for(var f=0;f<a.length;f++){var g=a[f],h=e;if(1<a.length){h=h+g.id+"/";var k={};k[g.id]=g.name,Locale.define("en-AU","pages",k)}c&&seqta.chrome.registerPage(h+"upcoming:"+g.id,seqta.coneqt.page.assessments.Upcoming,{label:Locale.get("pages.upcoming"),order:1,options:{enabledUpcoming:c}});for(var l=0;l<g.terms.length;l++)b(h,g.terms[l],l,g.id)}else{c&&seqta.chrome.registerPage("/assessments/upcoming",seqta.coneqt.page.assessments.Upcoming,{label:Locale.get("pages.upcoming"),order:1,options:{enabledUpcoming:c}});for(f=0;f<a.length;f++)b(e,a[f],f)}const m=new seqta.coneqt.part.assessments.Wisp;msg.register("wispassessment.shown",a=>{var b=_slicedToArray(a,3);let c=b[0],d=b[1],e=b[2];return m.show({assessmentID:c,metaclassID:d,studentID:e})})})},!0)})},!0),seqta.coneqt.page.assessments.Upcoming=new Class({Extends:seqta.base.Page,options:{},Binds:["draw","_retrieveData","_getProps","_loadSettings"],_student:null,_element:null,_enablePrint:!0,_settingsLoaded:!1,initialize:function(a,b,c){var d=c.split("/").getLast().split(":");this._student=+d[1],msg.register("user.settings.loaded",this._retrieveData,!0)},draw:function(){if(!this._settingsLoaded)return;let a=null;var b=seqta.chrome.getContentArea();b.getChildren().dispose(),this._element=new seqta.base.ComponentWrapper({component:SEQTATeachModules.Assessments,className:"assessments",props:this._getProps()}),this._message&&(a=new Element("div",{class:"message",html:this._message})),b.grab(new Element("div",{class:"assessmentsWrapper upcoming"}).adopt(a,this._element))},_getProps:function(){const a={upcoming:!0,taskView:!0,printing:this._enablePrint};return{studentId:this._student,enabledViews:a}},_retrieveData(){dataStore.retrieve("siteSettings",this._loadSettings)},_loadSettings:function(a){let b;(b=a["coneqt-p.assessments.print"])&&"disabled"===b.value&&(this._enablePrint=!1),b=a["coneqt-s.assessments.upcoming.message"],this._message=b&&b.value||null,b=a["coneqt-p.assessments.upcoming.message"],this._message=this._message||b&&b.value||null,this._settingsLoaded=!0,this.draw()}});_extends=Object.assign||function(a){for(var b,c=1;c<arguments.length;c++)for(var d in b=arguments[c])Object.prototype.hasOwnProperty.call(b,d)&&(a[d]=b[d]);return a};seqta.coneqt.page.assessments.Viewer=new Class({Extends:seqta.base.Page,options:{colourPref:null},Binds:["draw","_getProps","_retrieveData","_loadSettings","_selectAssessment","setParams","getParams"],_enableTaskView:!0,_enableSyllabusView:!0,_enablePrinting:!0,_enableUpcoming:!0,_message:null,_assessmentId:null,_settingsLoaded:!1,_element:null,_path:null,_params:null,initialize:function(a,b,c){this.setOptions(a);var d=c.split("/").getLast().split(":");this._programme=+d[0],this._metaclass=+d[1],d[2]&&(this._student=+d[2]),b&&b.item&&(this._assessmentId=+b.item),this._path=c,this._params=b,msg.register("user.settings.loaded",this._retrieveData,!0)},draw:function(){if(!this._settingsLoaded)return;let a=null;var b=seqta.chrome.getContentArea();b.getChildren().dispose(),this._element=new seqta.base.ComponentWrapper({component:SEQTATeachModules.Assessments,className:"assessments",props:this._getProps()}),this._message&&(a=new Element("div",{class:"message",html:this._message})),b.grab(new Element("div",{class:"assessmentsWrapper"}).adopt(a,this._element))},_getProps:function(){const a={taskView:this._enableTaskView,syllabusView:this._enableSyllabusView,printing:this._enablePrinting,upcoming:this._enableUpcoming};return{className:"assessments",programmeId:this._programme,metaclassId:this._metaclass,studentId:this._student,assessmentId:this._assessmentId,accentColour:this.options.colourPref&&this.options.colourPref.value,onSelectAssessment:this._selectAssessment,enabledViews:a}},_retrieveData(){dataStore.retrieve("siteSettings",this._loadSettings)},_loadSettings:function(a){let b;const c="student"===user.type?"coneqt-s":"coneqt-p";(b=a[`${c}.assessments.past.task`])&&"disabled"===b.value&&(this._enableTaskView=!1),(b=a[`${c}.assessments.past.syllabus`])&&"disabled"===b.value&&(this._enableSyllabusView=!1),(b=a[`${c}.assessments.upcoming`])&&"disabled"===b.value&&(this._enableUpcoming=!1),(b=a["coneqt-p.assessments.print"])&&"disabled"===b.value&&(this._enablePrinting=!1),b=a[`${c}.assessments.past.message`],this._message=b&&b.value||null,this._settingsLoaded=!0,this.draw()},_selectAssessment:function(a){const b=a&&a.id||null;b!==this._assessmentId&&(window.history.pushState(null,null,`#?page=${this._path}${b?`&item=${b}`:""}`),this.setParams({item:b}))},setParams:function(a){this._params=_extends({page:(a||this._params||{}).page},a),this._assessmentId=this._params&&this._params.item?+this._params.item:null,this._element&&this._element.render(this._getProps())},getParams:function(){return this._params}}),seqta.coneqt.page.Courses=new Class({Extends:seqta.base.Page,options:{urls:{load:"load/courses",file:null,coverFile:null}},Binds:["draw","getToolbar","_receiveData","_goNavSelect","_selectToday","_selectLesson","_drawCover","_drawLesson","_drawResource","_showNavigator","_getRestrictedDisplay","cleanup"],_term:null,_programme:null,_metaclass:null,_student:void 0,_element:null,_navigator:null,_content:null,_goToButton:null,_todayButton:null,_navDialog:null,_goNavigator:null,_lessonFrame:null,_courseData:null,_siteSettings:null,_themeOverride:null,initialize:function(a,b,c){var d=c.split("/"),e=d.getLast().split(":");this._term=d[2],this._programme=e[0],this._metaclass=e[1],this._student=e[2];const f=user.getPreference("creator_theme");this._themeOverride=f&&f.value},draw:function(){var a=this;Promise.resolve().then(()=>new Promise((a,b)=>{try{dataStore.retrieve("siteSettings",a)}catch(a){b(a)}})).then(function(){let b=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};const d=SEQTATeachModules.createProgrammePresenterBuilder;return a._siteSettings=b,d().withModules(void 0).withTheme(void 0).withUser(user).withProgrammeId(a._programme).withMetaclassId(a._metaclass).withStudentId(a._student).withSiteSettings(a._siteSettings).withExtraClass("use-intrinsic-height").build()}).then(a=>{var b=seqta.chrome.getContentArea();b.getChildren().dispose(),this._lessonFrame=a,this._element=new Element("div",{class:"course"}).inject(b)}).then(()=>{ajax.send(this.options.urls.load,{programme:this._programme,metaclass:this._metaclass,student:this._student},this._receiveData)}).catch(a=>{throw dbug&&dbug.error(a),a})},cleanup:function(){this._lessonFrame&&(this._lessonFrame.cleanup(),this._lessonFrame=null)},getToolbar:function(){return this._goToButton=this._goToButton||new seqta.ui.Button({id:"coursesGoTo",defaultValue:Locale.get("programme.goTo"),onClick:this._showNavigator}),this._todayButton=this._todayButton||new seqta.ui.Button({defaultValue:Locale.get("programme.today"),onClick:this._selectToday}),[this._goToButton,this._todayButton]},_receiveData:function(a){this._courseData=a,this._content=new Element("div",{class:"content "+a.coneqtLessonVisibility}),"cover"===a.coneqtLessonVisibility?(this._navigator=null,this._drawCover()):(this._navigator=new seqta.base.part.ProgramNavigator({onChange:this._selectLesson,orderable:!0}),this._navigator.setData(this._courseData)),this._element.adopt(this._navigator,this._content)},_goNavSelect:function(a){this._navigator.setSelected(a),this._navDialog.hide()},_selectToday:function(){this._navigator&&(this._navigator.selectToday(),this._goNavigator&&this._goNavigator.setSelected(this._navigator.getSelected(),!0))},_selectLesson:function(a,b,c,d){this._content.empty(),this._goNavigator&&this._goNavigator.setSelected(a,!0),"cover"===a?this._drawCover():d&&(d.t||d.l||d.document||d.h||d.o||d.r&&d.r.length&&this._courseData.r)?this._drawLesson(d):this._content.grab(new Element("div",{class:"note",html:Locale.get("programme.blank")}))},_drawCover:function(){var a=SEQTATeachModules.lti;const b=a.applications,c=a.getApplicationLaunchUrl;var d,e=this._student||user.userID,f=c(b.myedonline,["resourceId="+this._courseData.u,"programmeId="+this._programme,"studentId="+e]),g=c(b.moodle,["programmeId="+this._programme]);d=this._courseData.im?Configuration.fileURL.substitute({type:"program",uuid:this._courseData.im}):global.getImagePath()+"covers/"+this._courseData.i%10+".png",this._coverImage=new Element("div",{class:"coverImage",styles:{"background-image":"url("+d+")"}});const h=this._coverImage,i=document.createElement("img");i.src=d,i.addEventListener("load",()=>{(1024>i.width||768>i.height)&&h.addClass("blurred")});const j=this._courseData.document&&this._deserialise(this._courseData.document);this._lessonFrame.changeConfig().withContext("programme").withMediaContext("cover").withModules(j&&j.modules).withTheme(this._themeOverride?this._themeOverride:j&&j.theme).withLegacyContent(this._courseData.o).withFormattedTextOptions({macro:{programme:this._programme,metaclass:this._courseData&&this._courseData.m,learnEngageView:!0,subject:this._courseData&&this._courseData.c&&this._courseData.c.split(/[. # ]/g)[1],student:this._student||user.userID,browser:{fileDefaults:{type:"cover"}}}}).withStudentId(this._student).withUser(user).withTermCode(this._term).withProgrammeId(this._programme).withMetaclassId(this._metaclass).withSiteSettings(this._siteSettings).withResources(this._courseData.cf).done(),this._content.adopt(new Element("div",{class:"header"}).adopt(this._coverImage,this._courseData.t&&this._courseData.t.trim()?new Element("h1",{text:this._courseData.t}):null),this._lessonFrame),this._courseData.myed&&this._content.adopt("contact"===user.type?this._getRestrictedDisplay("myEd"):new seqta.ui.Frame({dangerouslyAllowSameOriginAccessEnableAtYourOwnPeril:!0,extraClass:"myEd",autoSize:!1,src:f})),this._courseData.moodle&&("contact"===user.type?this._content.adopt(this._getRestrictedDisplay("moodle")):this._content.adopt(new seqta.ui.Frame({extraClass:"moodle",autoSize:!1,src:g})))},_getRestrictedDisplay:function(a){return new Element("div",{class:"application restricted"}).adopt(new Element("div",{class:"title",html:Locale.get("application.restricted.note")}),new Element("div",{class:"message",html:Locale.get("application.restricted.details",[a])}))},_drawLesson:function(a){var b,c,d,e;b=new Element("h1",{text:a.t||""});var f=[];a.r&&(f=a.r.filter(function(a){return!!a.filename}));const g=a.document&&a.document.contents&&this._deserialise(a.document.contents);this._lessonFrame.changeConfig().withLessonId(a.i).withContext("programmedetail").withMediaContext("resource").withModules(g&&g.modules).withTheme(this._themeOverride?this._themeOverride:g&&g.theme).withLegacyContent(a.l).withFormattedTextOptions({macro:{programme:this._programme,metaclass:this._courseData&&this._courseData.m,learnEngageView:!0,subject:this._courseData&&this._courseData.c&&this._courseData.c.split(/[. # ]/g)[1],student:this._student||user.userID,browser:{fileDefaults:{type:"resource"}}}}).withTermCode(this._term).withStudentId(this._student).withUser(user).withProgrammeId(this._programme).withMetaclassId(this._metaclass).withSiteSettings(this._siteSettings).withResources(f).done(),a.o&&(c=new Element("div",{class:"outline"}).adopt(new Element("h2",{html:Locale.get("courses.outline")}),new seqta.ui.Frame({dangerouslyAllowUnfilteredContentEnableAtYourOwnPeril:!0,extraClass:"content",macro:{programme:this._programme,metaclass:this._courseData&&this._courseData.m,learnEngageView:!0,subject:this._courseData&&this._courseData.c&&this._courseData.c.split(/[. # ]/g)[1],student:this._student||user.userID}},a.o.decodeURI()))),a.h&&(d=new Element("div",{class:"homework"}).adopt(new Element("h2",{html:Locale.get("courses.homework")}),new Element("div",{class:"content",text:a.h}))),a.r&&a.r.length&&this._courseData.r&&(e=new seqta.ui.ResourceList({fileDefaults:{type:"resource"},enableDelete:!1,maxCount:a.r.length})).set(a.r),this._content.adopt(b,this._lessonFrame,c,d,e)},_drawResource:function(a){var b=new Element("li",{class:"resource"}),c=null;return a.p?(c=new Element("a",{target:"_blank",href:a.p,text:a.t||a.p||Locale.get("courses.untitledResource")}),b.grab(c)):a.uuid?b.grab(new seqta.ui.File({showMeta:!1,showLink:!0,iconSize:16,fileDefaults:{type:"resource"}},a)):b.set("text",a.t||Locale.get("courses.untitledResource"))},_showNavigator:function(){this._navDialog=this._navDialog||new seqta.ui.SlidePane({extraClass:"tall"}),this._goNavigator=this._goNavigator||new seqta.base.part.ProgramNavigator({onChange:this._goNavSelect,orderable:!0}),this._goNavigator.setData(this._courseData),this._navDialog.show(Locale.get("programme.goTo"),this._goNavigator,["cancel"])},_deserialise:function(a){return(0,SEQTATeachModules.composer.deserialise)(a)}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){for(var b=["coneqt-p.courses","coneqt-s.courses"],c=0;c<b.length;c++)if(a[b[c]]&&a[b[c]].value&&"disabled"===a[b[c]].value)return;msg.register("user.settings.loaded",function(){dataStore.retrieve("subjects",function(a){var b=function(a,b,d,e){var f=a;b.active||(f=f+b.code+"/");for(var g=0;g<b.subjects.length;g++)c(f,b.subjects[g],b.active,d,e)},c=function(a,b,c,d,e){var f=a+b.programme+":"+b.metaclass;e&&(f=f+":"+e),seqta.chrome.registerPage(f,seqta.coneqt.page.Courses,{label:b.title,order:50,folderOrder:c?50:99+d,colourPref:"timetable.subject.colour."+(e?e+".":"")+b.code})},d="/courses/";if("contact"===user.type){for(var e,f=0;f<a.length;f++)if((e=a[f]).terms&&e.terms.length){var g=d;if(1<a.length){g=g+e.id+"/";var h={};h[e.id]=e.name,Locale.define("en-AU","pages",h)}for(var l=0;l<e.terms.length;l++)b(g,e.terms[l],l,e.id)}}else for(var m=0;m<a.length;m++)b(d,a[m],m)})},!0)})},!0),seqta.coneqt.page.Dashboard=new Class({Extends:seqta.base.Page,options:{urls:{load:"dashboard",save:"dashboard"}},Binds:["draw","getToolbar","cleanup","_cleanupDashlet","_doCleanup","_populateManageList","_receiveData","_receiveSettings","_drawDashlet","_getDashletContainer","_instantiateDashlet","_changeSelected","_deleteDashlet","_addDashlet","_reorder","_configureDashlet","isDirty","_getDirtyState","_isDirtyDashlet"],_element:null,_dashlets:null,_used:null,_available:null,_students:null,_manageListC:null,_manageList:null,initialize:function(a){this.parent(a),this._dashlets={}},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"dashboard"}).inject(a),dataStore.retrieve("siteSettings",this._receiveSettings)},getToolbar:function(){return this._manageListC=this._manageListC||new Element("span"),[this._manageListC]},cleanup:function(){this._dashlets&&Object.each(this._dashlets,this._cleanupDashlet)},_cleanupDashlet:function(a){a&&0<=a.length?a.forEach(this._doCleanup):this._doCleanup(a)},_doCleanup:function(a){a&&a.cleanup&&a.cleanup.attempt&&a.cleanup.attempt()},_populateManageList:function(){if(!this._manageList){var a=this._available.map(function(a){return{value:a.ident,label:Locale.get("dashlet."+a.ident+".title"),checked:!!this._dashlets[a.ident]}},this);a.sortObjects("label"),this._manageList=new seqta.ui.ButtonChecklist({items:a,onChange:this._changeSelected}),this._manageListC.grab(this._manageList)}},_receiveData:function(a){this._used=[],this._students=a.students,this._available=a.available||[];var b=a.used.map(this._drawDashlet);this._element.adopt(b),this._reorder(),this._populateManageList()},_receiveSettings:function(a){for(var b=["coneqt-p.dashboard.message","coneqt-s.dashboard.message"],c=null,d=0;d<b.length;d++)a[b[d]]&&a[b[d]].value&&(c=a[b[d]].value);c&&this._element.grab(new Element("section",{class:"message",html:c}),"top"),ajax.send(this.options.urls.load,{},this._receiveData)},_drawDashlet:function(a){var b=JSON.parse.attempt(a.config)||{},c=JSON.parse.attempt(a.params)||{};return this._used.push(a),["summary-homework","summary-absence","summary-pastoral","pastoral","timetable"].includes(a.ident)&&this._students?(this._dashlets[a.ident]=[],this._students.map(function(d){return this._getDashletContainer(a.ident,Object.merge({},d,b,c))}.bind(this))):this._getDashletContainer(a.ident,Object.merge({},b,c))},_getDashletContainer:function(a,b){var c=new Element("div",{class:"actions"}),d=this._instantiateDashlet(a,b,c);if(["summary-homework","summary-absence","summary-pastoral","pastoral","timetable"].includes(a)&&this._students?this._dashlets[a].push(d):this._dashlets[a]=d,!d)return null;var f=new Element("div",{class:"header"}),g=new Element("div",{class:"title",html:d.getTitle?d.getTitle():a});f.adopt(g,c);var h=null;b.message&&(h=new Element("div",{class:"message",html:b.message}));var i=new Element("div",{class:"dashlet","data-ident":a}),j=new Element("div",{class:"content"}).adopt(d);return i.adopt(f,h,j),i},_instantiateDashlet:function(a,b,c){return b.onConfigure=this._configureDashlet,"motd"===a?new seqta.base.dashlet.MOTD(b,c):"notes"===a?new seqta.base.dashlet.Notes(b,c):"sentence"===a?new seqta.base.dashlet.Sentence(b,c):"tasks"===a?new seqta.base.dashlet.Tasks(b,c):"summary-absence"===a?new seqta.coneqt.dashlet.SummaryAbsence(b,c):"summary-homework"===a?new seqta.coneqt.dashlet.SummaryHomework(b,c):"summary-pastoral"===a?new seqta.coneqt.dashlet.SummaryPastoral(b,c):"pastoral"===a?new seqta.coneqt.dashlet.Pastoral(b,c):"timetable"===a?new seqta.coneqt.dashlet.Timetable(b,c):"profile"===a?new seqta.base.dashlet.Profile(b,c):"links"===a?new seqta.coneqt.dashlet.Links(b,c):null},_changeSelected:function(a){for(var b=Object.keys(this._dashlets),c=0;c<b.length;c++)a.contains(b[c])||this._deleteDashlet(b[c]);for(c=0;c<a.length;c++)this._dashlets[a[c]]||this._addDashlet(a[c])},_deleteDashlet:function(a){if(this._dashlets[a]){for(var b=0;b<this._used.length;b++)if(this._used[b].ident===a&&this._used[b].req)return;this._cleanupDashlet(this._dashlets[a]),this._dashlets[a]=null;var c=this._element.getElements(".dashlet[data-ident = "+a+"]");c&&c.destroy(),this._used=this._used.filter(function(b){return b.ident!==a}),ajax.send(this.options.urls.save,{ident:a,delete:!0}),this._reorder()}},_addDashlet:function(a){var b=this._available.first(function(b){return b.ident===a&&!b.req});if(b){var c=Object.merge({},b,{order:this._used.length});this._element.adopt(this._drawDashlet(c)),ajax.send(this.options.urls.save,{id:c.id,order:c.order})}},_reorder:function(){for(var a=!1,b=0,c=0;c<this._used.length;c++)this._used[c].req||(a=this._used[c].order!==b,this._used[c].order=b,b+=1);a&&ajax.send(this.options.urls.save,{reorder:this._used.map(function(a){return{id:a.id,order:a.order}})})},_configureDashlet:function(a,b){var c=Object.keyOf(this._dashlets,b);if(c){var d=this._used.first(function(a){return a.ident===c});d&&(d.config=JSON.stringify(a),ajax.send(this.options.urls.save,{id:d.id,params:d.config}))}},isDirty:function(){var a=!1;return Object.each(this._dashlets,function(b){a=a||this._getDirtyState(b)}.bind(this)),a},_getDirtyState:function(a){return a&&a.some?a.some(this._isDirtyDashlet):this._isDirtyDashlet(a)},_isDirtyDashlet:function(a){return a&&a.isDirty&&a.isDirty()}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){for(var b=["coneqt-s.page.dashboard","coneqt-p.page.dashboard"],c=0;c<b.length;c++)if(a[b[c]]&&"disabled"===a[b[c]].value)return;seqta.chrome.registerPage("/dashboard",seqta.coneqt.page.Dashboard,{label:Locale.get("pages.dashboard")})})},!0),seqta.coneqt.page.Documents=new Class({Extends:seqta.base.Page,options:{urls:{load:"load/documents"},defaultColour:"#ddd"},Binds:["draw","getToolbar","_receiveData","_render","_drawListItem","_changeLabels","_search"],_element:null,_documents:null,_labelListC:null,_labelList:null,_elTable:null,initialize:function(a){this.parent(a)},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"documents"}).inject(a),ajax.send(this.options.urls.load,{},this._receiveData)},getToolbar:function(){return this._labelListC=this._labelListC||new Element("span"),[this._labelListC,new Element("span").adopt(new seqta.ui.ShortText({className:"search",placeholder:Locale.get("documents.search"),defaultValue:"",maxLength:64,onPause:this._search}))]},_receiveData:function(a){if(this._documents=a,this._documents.length){var b=null,c=user.getPreference("documents.filters");null!==(c=c&&c.value)&&(b=c.split(" ").map(Number)),this._labelList=new seqta.ui.ButtonChecklist({allButton:!0,items:this._documents.map(function(a){var d=!1;return(null===c||-1!==b.indexOf(a.id))&&(d=!0),{value:a.id,label:a.category,checked:d}}),onChange:this._changeLabels}),this._labelListC.grab(this._labelList),this._render(),b&&this._changeLabels(b,!0)}else this._element.grab(new Element("div",{class:"note",html:Locale.get("documents.noDocuments")}))},_render:function(){this._elTable=new Element("table",{cellspacing:"0",class:"list"});var a=new Element("thead").inject(this._elTable);new Element("tr").inject(a).adopt(new Element("th",{class:"colourBar",html:"&nbsp;"}),new Element("th",{class:"title",html:Locale.get("documents.title")}),new Element("th",{class:"date",html:Locale.get("documents.date")}),new Element("th",{class:"size",html:Locale.get("documents.size")}));for(var c,d=new Element("tbody").inject(this._elTable),e=[],f=0;f<this._documents.length;f++){c=this._documents[f];for(var g=0;g<c.docs.length;g++)e.push(this._drawListItem(c,c.docs[g]))}d.adopt(e),this._element.getElements().dispose(),this._element.grab(this._elTable)},_drawListItem:function(a,b){a.colour||(a.colour=this.options.defaultColour);var c=new Element("td",{class:"colourBar",text:a.category||" ",styles:{"background-color":a.colour}});c.addClass("#fff"===new Color(a.colour).yiqContrast()?"light":"dark");var d=new Element("td",{class:"title"}).adopt(new seqta.ui.File({styleMode:"rows",showColour:!1,showMeta:!1,showLink:!0,iconSize:16,fileDefaults:{type:"document"}},Object.merge(b,{filename:b.title||b.filename}))),e=new Element("td",{class:"date",html:b.created_date.toDate().print(Locale.get("date.shortDateFormat"))}),f=new Element("td",{class:"size",text:b.size.formatByteSize()}),g=new Element("tr",{class:"document","data-id":b.file,"data-category":a.id});return g.adopt(c,d,e,f),g},_changeLabels:function(a,b){this._elTable.getElements("tr.document.label-match").removeClass("label-match");var c=null;b||(c="");for(var d=0;d<a.length;d++)b||(c=c+a[d]+" "),this._elTable.getElements('tr.document[data-category="'+a[d]+'"]').addClass("label-match");b||user.savePreference("documents.filters",c.trim()),this._elTable.addClass("label-filter")},_search:function(a){return a&&a.length?(a=a.toLowerCase(),$(this._elTable).getElements("tr").each(function(b){b.get("text").toLowerCase().contains(a)?b.addClass("search-match"):b.removeClass("search-match")}),void $(this._elTable).addClass("search-filter")):void $(this._elTable).removeClass("search-filter")}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){for(var b=["coneqt-s.page.documents","coneqt-p.page.documents"],c=0;c<b.length;c++)if(a[b[c]]&&"disabled"===a[b[c]].value)return;seqta.chrome.registerPage("/documents",seqta.coneqt.page.Documents,{label:Locale.get("pages.documents")})})},!0),seqta.coneqt.page.FolioEditor=new Class({Extends:seqta.base.Page,options:{editorActions:"+insertmacro",urls:{load:"folio",save:"folio",assessments:"assessment/wisp/list",forum:{load:"load/forums",save:"save/forums"},people:"load/message/people",staffCoords:"load/staff/coordinators"}},Binds:["draw","getToolbar","cleanup","save","_saved","isDirty","_retrieveList","_receiveList","_retrieveFolio","_receiveFolio","_drawList","_drawListItem","_drawFolio","_selectItem","_discardAndSelect","_saveAndSelect","_newFolio","_discardAndNew","_saveAndNew","_drawFolioHeader","_drawFolioEditor","_editFolioPeople","_updateFolioPeople","_deleteFolio","_performDelete","_deleted","_retrieveStudentData","_retrieveContactData","_retrieveStaffData","_setDirty","_makeDirty","_editChanged","_toggleNavigator","_import","_showImport","_selectImportItem","_drawImportItem","_performImport","_discardAndImport","_saveAndImport"],_dirty:!1,_createButton:null,_saveButton:null,_navButton:null,_importButton:null,_element:null,_list:null,_current:null,_editor:null,_stylesheets:null,_dlgImport:null,_elImportItems:null,_folioID:null,_joList:null,_joFolio:null,initialize:function(a,b,c){this.parent(a),this._folioID=c.split("/").getLast().toInt(),isNaN(this._folioID)&&(this._folioID=null),this._stylesheets=$(document.head).getChildren('link[rel="stylesheet"]').map(function(a){return a.get("href")})},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"folioEditor"}).inject(a),this._current?this._current.getChildren().dispose():this._current=new Element("div",{class:"current"}).inject(this._element),this._list?this._list.getChildren().dispose():this._list=new Element("div",{class:"list",events:{"click:relay(.item:not(.current))":this._selectItem}}).inject(this._element),this._retrieveList(),this._folioID&&this.setID(this._folioID)},getToolbar:function(){return this._createButton=this._createButton||new seqta.ui.Button({defaultValue:Locale.get("folios.editor.create"),extraClass:"create",onClick:this._newFolio}),this._saveButton=this._saveButton||new seqta.ui.Button({defaultValue:Locale.get("general.save"),extraClass:"save",onClick:this.save}),this._navButton=this._navButton||new seqta.ui.ButtonToggle({defaultValue:Locale.get("folios.toggleNavigator"),id:"folioNav",onToggle:this._toggleNavigator}),this._folioID||(this._navButton.setToggled(!0),this._toggleNavigator(!0)),this._importButton=this._importButton||new seqta.ui.Button({defaultValue:Locale.get("folios.editor.importWisp"),extraClass:"import",onClick:this._import}),this._deleteButton=this._deleteButton||new seqta.ui.Button({defaultValue:Locale.get("folios.editor.delete"),extraClass:"delete",onClick:this._deleteFolio}),[this._navButton,this._saveButton,this._createButton,this._importButton,this._deleteButton]},cleanup:function(){},setID:function(a){this._folioID=a,this._retrieveFolio()},save:function(a){this.isDirty()&&(this._joFolio.title=this._editor.title.get(),this._joFolio.tags=this._editor.tags.get(),this._joFolio.contents=this._editor.edit.get(),this._joFolio.files=this._editor.edit.getFiles(),this._joFolio.published=this._editor.published.get()?(this._joFolio.published||new Date).toDate().print("sqlTimestamp"):null,this._joFolio.forum.closed=!this._editor.forumEnabled.get(),ajax.send(this.options.urls.save,{mode:"adminSave",data:this._joFolio},a&&"function"===typeOf(a)?a:this._saved))},_saved:function(a){this._setDirty(!1);var b=this._joList.first(function(b){return b.id===a.id}),c=!b,d=!(!this._joFolio||c)&&this._joFolio.published;this._folioID=a.id,c?((b=a).created=new Date,this._joList.push(b),this._joFolio=Object.clone(b)):this._editor&&(b.title=this._editor.title.get()),b.updated=new Date,b.published=d;var e=this._list.getElement(".current");e&&e.removeClass("current");var f=this._drawListItem(b);f.addClass("current"),(e=this._list.getElement("[data-id="+a.id+"]"))?f.replaces(e):this._list.grab(f,"top"),c&&(this._drawFolio(),this._setDirty(!1))},isDirty:function(){return this._dirty},_retrieveList:function(){ajax.send(this.options.urls.load,{mode:"adminList"},this._receiveList)},_receiveList:function(a){this._joList=a,this._drawList()},_retrieveFolio:function(){this._folioID&&ajax.send(this.options.urls.load,{mode:"adminLoad",id:this._folioID},this._receiveFolio)},_receiveFolio:function(a){this._joFolio=a,this._drawFolio(),this._setDirty(!1)},_drawList:function(){this._list.adopt(this._joList.map(this._drawListItem))},_drawListItem:function(a){var b=new Element("div",{class:"item","data-id":a.id}),c=new Element("div",{class:"title",text:a.title}),d=new Element("div",{class:"time"});return a.published?(d.set("html",Locale.get("folios.editor.published",a.published.toDate().print(Locale.get("date.dateTimeFormat")))),b.addClass("published")):(b.addClass("unpublished"),d.set("html",Locale.get("folios.editor.unpublished"))),b.adopt(c,d),this._joFolio&&a.id===this._joFolio.id&&b.addClass("current"),b},_drawFolio:function(){this._editor=this._editor||{},this._drawFolioHeader(),this._drawFolioEditor()},_selectItem:function(a,b){var c=b.get("data-id");if(c&&(c=c.toInt())!==this._folioID){if(this.isDirty())return void new seqta.ui.SlidePane({compact:!0,onDiscard:this._discardAndSelect.pass(c),onSave:this._saveAndSelect.pass(c)}).showConfirm(Locale.get("general.unsavedChangesT"),Locale.get("general.unsavedChanges"),[["save","discard"],"cancel"]);var e=this._list.getElement(".current");e&&e.removeClass("current"),b.addClass("current"),this.setID(c)}},_discardAndSelect:function(a){this._setDirty(!1);var b=this._list.getElement(".current");b&&b.removeClass("current");var c=this._list.getElement("[data-id="+a+"]");c&&c.addClass("current"),this.setID(a)},_saveAndSelect:function(a){this.save(function(b){this._saved(b);var c=this._list.getElement(".current");c&&c.removeClass("current");var d=this._list.getElement("[data-id="+a+"]");d&&d.addClass("current"),this.setID(a)}.bind(this))},_newFolio:function(){this.isDirty()?new seqta.ui.SlidePane({compact:!0,onDiscard:this._discardAndNew,onSave:this._saveAndNew}).showConfirm(Locale.get("general.unsavedChangesT"),Locale.get("general.unsavedChanges"),[["save","discard"],"cancel"]):ajax.send(this.options.urls.save,{mode:"adminSave",data:{title:Locale.get("folios.editor.defaultTitle"),contents:""}},this._saved)},_discardAndNew:function(){this._setDirty(!1),this._newFolio()},_saveAndNew:function(){this.save(function(a){this._saved(a),this._newFolio()}.bind(this))},_drawFolioHeader:function(){this._editor.title||(this._editor.title=new seqta.ui.ShortText({className:"title",onChange:this._makeDirty}),this._editor.tags=new seqta.ui.TagEditor({label:Locale.get("folios.editor.tags"),onChange:this._makeDirty}),this._editor.forumEnabled=new seqta.ui.Checkbox({label:Locale.get("folios.editor.forumEnabled"),boxClass:"forumEnabled",onChange:this._makeDirty}),this._editor.published=new seqta.ui.Checkbox({label:Locale.get("folios.editor.publish"),boxClass:"published",onChange:this._makeDirty}),this._editor.peopleLabel=new Element("div",{class:"details"}),this._editor.peoplePanel=new Element("div",{class:"folioEditorPeoplePanel"}),this._editor.people=new seqta.ui.ButtonPanelDropdown({defaultValue:Locale.get("folios.editor.editPeople"),onBeforeShow:this._editFolioPeople},this._editor.peoplePanel),new Element("div",{class:"header"}).adopt(this._editor.title,this._editor.tags,this._editor.forumEnabled.getBox(),this._editor.published.getBox(),new Element("div",{class:"people"}).adopt(this._editor.peopleLabel,this._editor.people)).inject(this._current));this._editor.title.set(this._joFolio.title||""),this._editor.tags.set(this._joFolio.tags||[]),this._editor.published.set(!!this._joFolio.published),this._joFolio.forum=this._joFolio.forum||{};var b=this._joFolio.forum,c=!b.closed||b.closed.toDate()>new Date;b.students||(b.students=[user.userID]),this._editor.forumEnabled.set(c),this._editor.peopleLabel.set("html",Locale.get("folios.editor.editPeopleLabel",[b.students,b.staff,b.contacts])),this._editor.peopleLabel.set("title",Locale.get("folios.editor.editPeopleLabelTitle",[b.students,b.staff,b.contacts]))},_drawFolioEditor:function(){this._editor.editC?this._editor.editC.getChildren().dispose():this._editor.editC=new Element("div",{class:"editor"}).inject(this._current),this._editor.edit=new seqta.ui.FormattedText({onChange:this._editChanged,onFilesChange:this._makeDirty,macro:{browser:{mode:"folio",sources:[{enabled:!0,name:Locale.get("folios.editor.browser.folio"),request:{mode:"folios"}},{name:Locale.get("folios.editor.browser.assessments"),request:{mode:"assessments"}}],urls:{link:this.options.urls.save,remove:this.options.urls.save},enableUpload:!0,files:this._joFolio.files,fileDefaults:{type:"folio"},linkParams:{mode:"linkFile",folio:this._folioID},remParams:{mode:"linkFile",folio:this._folioID,delete:!0}}}},this._joFolio.contents||""),this._editor.editC.grab(this._editor.edit),this._editor.edit.ready()},_editFolioPeople:function(){this._editor.peopleSelector||(this._editor.peopleSelector=new seqta.ui.AnyoneSelect({onChange:this._updateFolioPeople,urls:{staffCoords:this.options.urls.staffCoords},enableMany:{students:!0,staff:!0,contacts:!1},enableStudentTab:{boarder:!1,indigenous:!1,group:!1,classes:!1,code:!1},showClearButton:!0}),this._editor.peoplePanel.grab(this._editor.peopleSelector),this._retrieveStudentData(this._editor.peopleSelector.setStudentsData),this._retrieveContactData(this._editor.peopleSelector.setContactsData),this._retrieveStaffData(this._editor.peopleSelector.setStaffData)),this._editor.peopleSelector.clear(!0),this._editor.peopleSelector.addStudents(this._joFolio.forum.students,!0),this._editor.peopleSelector.addStaff(this._joFolio.forum.staff,!0),this._editor.peopleSelector.addContacts(this._joFolio.forum.contacts,!0)},_updateFolioPeople:function(){var a=this._editor.peopleSelector.get(),b=this._joFolio.forum;b.staff=a.staff,b.students=a.students,b.contacts=a.contacts,this._editor.peopleLabel.set("html",Locale.get("folios.editor.editPeopleLabel",[b.students,b.staff,b.contacts])),this._editor.peopleLabel.set("title",Locale.get("folios.editor.editPeopleLabelTitle",[b.students,b.staff,b.contacts])),this._makeDirty()},_deleteFolio:function(){this._joFolio&&this._joFolio.id&&new seqta.ui.SlidePane({compact:!0,onDelete:this._performDelete}).showConfirm(Locale.get("folios.editor.reallyDeleteT",this._joFolio.title),Locale.get("folios.editor.reallyDelete",this._joFolio.title),["cancel","delete"])},_performDelete:function(){this._joFolio&&this._joFolio.id&&(this._setDirty(!1),ajax.send(this.options.urls.save,{mode:"adminDelete",id:this._folioID},this._deleted))},_deleted:function(a){var b=a.id;this._joList=this._joList.filter(function(a){return a.id!==b});var c=this._list.getElement("[data-id="+b+"]");c&&c.setStyle("height",c.getStyle("height")).addClass("vanquished").removeClass("current"),this._joFolio=null,this._editor={},this._current.getChildren().destroy()},_retrieveStudentData:function(a){a&&"function"===typeOf(a)&&ajax.send(this.options.urls.people,{mode:"student"},function(b){for(var c=0;c<b.length;c++)b[c].xx_value=b[c].id;a(seqta.coneqt.common.postProcessStudents(b))}.bind(this))},_retrieveContactData:function(a){a&&"function"===typeOf(a)&&ajax.send(this.options.urls.people,{mode:"contact"},function(b){for(var c=0;c<b.length;c++)b[c].xx_value=b[c].id;a(b)})},_retrieveStaffData:function(a){a&&"function"===typeOf(a)&&ajax.send(this.options.urls.people,{mode:"staff"},function(b){for(var c=0;c<b.length;c++)b[c].xx_value=b[c].id;a(b)})},_setDirty:function(a){if(a||void 0===a){if(this._dirty)return;this._dirty=!0,this._saveButton&&$(this._saveButton).addClass("dirty")}else{if(!this._dirty)return;this._dirty=!1,this._saveButton&&$(this._saveButton).removeClass("dirty")}},_makeDirty:function(){this._setDirty(!0)},_editChanged:function(){var a=this._editor.edit.get();this._joFolio.contents===a||(this._joFolio.contents=a,this._makeDirty())},_toggleNavigator:function(a){a?this._element.addClass("navVisible"):this._element.removeClass("navVisible")},_import:function(){ajax.send(this.options.urls.assessments,{},this._showImport)},_showImport:function(a){this._dlgImport=this._dlgImport||new seqta.ui.SlidePane({extraClass:"folioEditorImport",onImport:this._performImport}),this._elImportItems=new Element("ul",{class:"items",events:{"click:relay(li)":this._selectImportItem}}).adopt(a.map(this._drawImportItem)),this._dlgImport.show(Locale.get("folios.editor.import.dialogTitle"),this._elImportItems,["import","cancel"])},_selectImportItem:function(a,b){var c=this._elImportItems.getElement(".selected");c&&c===b||(c&&c.removeClass("selected"),b.addClass("selected"))},_drawImportItem:function(a){return new Element("li",{"data-assessment":a.assessment,"data-snapshot":a.snapshot}).adopt(new Element("div",{class:"assessment",text:a.title+(a.snapshot?" "+Locale.get("folios.editor.import.snapshotSuffix"):"")}),new Element("div",{class:"programme",text:a.programme}),new Element("div",{class:"date",html:a.date.toDate().print(Locale.get("date.dateTimeFormat"))}))},_performImport:function(){if(this.isDirty()){new seqta.ui.SlidePane({compact:!0,onDiscard:this._discardAndImport,onSave:this._saveAndImport}).showConfirm(Locale.get("general.unsavedChangesT"),Locale.get("general.unsavedChanges"),[["save","discard"],"cancel"])}else{var b=this._elImportItems.getElement(".selected");if(b){var c=b.get("data-assessment").toInt(),d=b.get("data-snapshot");d&&(d=d.toInt()),isNaN(d)&&(d=null);var e=b.getFirst(".assessment").get("text");ajax.send(this.options.urls.save,{mode:"adminImport",data:{assessment:c,snapshot:d,title:e}},this._saved)}}},_discardAndImport:function(){this._setDirty(!1),this._performImport()},_saveAndImport:function(){this.save(function(a){this._saved(a),this._performImport()}.bind(this))}}),msg.register("chrome.ready",function(){"student"===user.type&&dataStore.retrieve("siteSettings",function(a){if(!a["global.folios"]||"disabled"!==a["global.folios"].value){for(var b=["coneqt-s.page.folios","coneqt-p.page.folios"],c=0;c<b.length;c++)if(a[b[c]]&&"disabled"===a[b[c]].value)return;seqta.chrome.registerPage("/folios/edit",seqta.coneqt.page.FolioEditor,{label:Locale.get("pages.folios/edit")})}})},!0),seqta.coneqt.page.Folios=new Class({Extends:seqta.base.Page,options:{urls:{load:"folio",forum:{load:"load/forums",save:"save/forums"}}},Binds:["draw","getToolbar","cleanup","_drawFolio","_toggleNavigator"],_navButton:null,_element:null,_folioID:null,_viewer:null,initialize:function(a,b){this.parent(a),this._folioID=b&&b.id&&b.id.toInt(),isNaN(this._folioID)&&(this._folioID=null)},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"folios"}).inject(a),this._drawFolio()},getToolbar:function(){return this._navButton=this._navButton||new seqta.ui.ButtonToggle({defaultValue:Locale.get("folios.toggleNavigator"),id:"folioNav",onToggle:this._toggleNavigator}),this._folioID||(this._navButton.setToggled(!0),this._toggleNavigator(!0)),[this._navButton]},cleanup:function(){this._viewer&&this._viewer.cleanup&&this._viewer.cleanup()},_drawFolio:function(){this._viewer?(this._viewer._draw(),this._viewer._retrieveList(),this._folioID&&this._viewer.setID(this._folioID)):this._viewer=new seqta.base.part.FolioView({urls:this.options.urls},this._folioID||null),this._element.adopt(this._viewer)},_toggleNavigator:function(a){a?this._element.addClass("navVisible"):this._element.removeClass("navVisible")}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){if(!a["global.folios"]||"disabled"!==a["global.folios"].value){for(var b=["coneqt-s.page.folios","coneqt-p.page.folios"],c=0;c<b.length;c++)if(a[b[c]]&&"disabled"===a[b[c]].value)return;"student"===user.type?seqta.chrome.registerPage("/folios/read",seqta.coneqt.page.Folios,{label:Locale.get("pages.folios/read")}):seqta.chrome.registerPage("/folios",seqta.coneqt.page.Folios,{label:Locale.get("pages.folios")})}})},!0),seqta.coneqt.page.Forums=new Class({Extends:seqta.base.Page,options:{urls:{loadList:"json/forum/load"},currentUserName:""},Binds:["draw","cleanup","getToolbar","_toggleSort","_render"],_element:null,_elSort:null,_forum:null,_ptForumView:null,initialize:function(a,b,c){this.setOptions(a),this._forum=c.split("/").getLast()},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"forums"}).inject(a),this._elMuteC=new Element("span"),this._render()},cleanup:function(){this._ptForumView&&this._ptForumView.cleanup()},getToolbar:function(){var a=null,b="forum.reverseSort";user.getPreference(b)&&(a=user.getPreference(b).value);var c=new Element("span");return this._elSort=new seqta.ui.ButtonMenu({defaultValue:a&&"enabled"===a?Locale.get("forum.descending"):Locale.get("forum.ascending"),onSelect:this._toggleSort,items:[{value:"ascending",label:Locale.get("forum.ascending")},{value:"descending",label:Locale.get("forum.descending")}]}),c.adopt(this._elSort),[c,this._elMuteC]},_toggleSort:function(a){var b=a&&"descending"===a.value;this._elSort.setLabel(a.label),user.savePreference("forum.reverseSort",b?"enabled":"disabled"),this._ptForumView&&this._ptForumView.toggleSort(b)},_render:function(){this._ptForumView&&(this._ptForumView.cleanup(),$(this._ptForumView).destroy()),this._ptForumView=new seqta.base.part.ForumView({urls:{load:"load/forums",save:"save/forums",file:"load/file?type=forum&file={id}",assPrint:"print/assessment"},currentUserName:this.options.currentUserName},this._forum),this._element.empty(),this._element.adopt(this._ptForumView),dbug.log("this._elMuteC",this._elMuteC),dbug.log("this._ptForumView",this._ptForumView),dbug.log("this._ptForumView.getMuteButton",this._ptForumView.getMuteButton),dbug.log("this._ptForum.getMuteButton()",this._ptForumView.getMuteButton()),this._elMuteC.grab(this._ptForumView.getMuteButton()),dbug.log("done!"),this._ptForumView.ready(),msg.send("forum.select",this._forum)}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){for(var b=["coneqt-s.page.forums","coneqt-p.page.forums"],c=0;c<b.length;c++)if(a[b[c]]&&"disabled"===a[b[c]].value)return;ajax.send("load/forums",{mode:"list"},function(a){var b,c,d;if(a.forums)for(var e=0;e<a.forums.length;e++)(c=a.forums[e]).closed?((d={})[b="/forums/closed/"+c.id]=c.title,Locale.define("en-AU","pages",d),seqta.chrome.registerPage(b,seqta.coneqt.page.Forums,{label:c.title,folderOrder:99,options:{currentUserName:a.me}})):((d={})[b="/forums/"+c.id]=c.title,Locale.define("en-AU","pages",d),seqta.chrome.registerPage(b,seqta.coneqt.page.Forums,{label:c.title,options:{currentUserName:a.me}}))})})},!0),seqta.coneqt.page.Goals=new Class({Extends:seqta.base.Page,options:{urls:{goals:"load/goals"},commands:[["Format"],["Bold","Italic","Underline"],["seqta-unorderedlist","seqta-orderedlist"]]},Binds:["draw","retrieveData","receiveData","setDirty","isDirty","getToolbar","_render","_renderFlexi","_renderStudent","_changeField","_addRow","_deleteRow","_doDeleteRow","save","_afterSave"],_element:null,_name:null,_year:null,_student:null,_elNotes:null,_elItemsBody:null,_goal:null,_header:null,_readonly:!1,_dirty:!1,_elDeleting:null,_saveButton:null,initialize:function(a,b,c){var d=c.split("/").getLast().split(":");this._year=d[0].toInt(),d[1]&&(this._student=d[1].toInt()),this._readonly="contact"===user.type},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"goals"+(this._readonly?" readonly":"")}).inject(a),this.retrieveData()},setDirty:function(a){if(a||void 0===a){if(this._dirty)return;this._dirty=!0,this._saveButton&&$(this._saveButton).addClass("dirty")}else{if(!this._dirty)return;this._dirty=!1,this._saveButton&&$(this._saveButton).removeClass("dirty")}},isDirty:function(){return this._dirty},getToolbar:function(){return this._saveButton=this._readonly?null:this._saveButton||new seqta.ui.Button({defaultValue:Locale.get("general.save"),onClick:this.save,extraClass:"save"}),[this._saveButton]},retrieveData:function(){ajax.send(this.options.urls.goals,{mode:"goals",student:this._student||void 0,year:this._year},this.receiveData)},receiveData:function(a){this._joData=a,this._header=this._joData.id,this._goal=this._joData.goal,this._readonly&&(this._name=this._joData.name),this._render()},_render:function(){var a=this._renderStudent();this._element.grab(a),dataStore.retrieve("siteSettings",function(b){var c=b["coneqt-s.goals.message"]||b["coneqt-p.goals.message"];c&&c.value&&a.grab(new Element("div",{class:"message",html:c.value}),"top")}.bind(this));var b=this._renderFlexi();b?this._element.grab(b):this._element.addClass("noflexi"),this._elNotes.ready&&this._elNotes.ready()},_renderFlexi:function(){var a=null,b=null;return this._joData.overview&&this._joData.overview.length&&(a=new Element("div",{class:"overview"}).adopt(new Element("h2",{html:Locale.get("goals.overview")}),new seqta.ui.Frame({extraClass:"content"},this._joData.overview))),this._joData.notes&&this._joData.notes.length&&(b=new Element("div",{class:"yearly"}).adopt(new Element("h2",{html:Locale.get("goals.yearly")}),new seqta.ui.Frame({extraClass:"content"},this._joData.notes))),a||b?new Element("div",{class:"flexi"}).adopt(a,b):null},_renderStudent:function(){this._elNotes=this._readonly?new seqta.ui.Frame({autoSize:!1,extraClass:"content"},this._joData.student_notes):new seqta.ui.FormattedText({commands:this.options.commands,onChange:this._changeField},this._joData.student_notes||""),this._elItemsBody=new Element("tbody"),this._joData.items&&this._elItemsBody.adopt(this._joData.items.map(function(a){var b=new Element("td",{class:"goals"}),c=new Element("td",{class:"support"}),d=new Element("td",{class:"action"}),e=new Element("td",{class:"notes"}),f=new Element("td",{class:"completed"}),g=!this._readonly&&new Element("td",{class:"delete"});return!this._readonly&&a.editable?(b.grab(new Element("textarea",{text:a.goals||"",events:{change:this._changeField}})),c.grab(new Element("textarea",{text:a.support||"",events:{change:this._changeField}})),d.grab(new Element("textarea",{text:a.action||"",events:{change:this._changeField}})),e.grab(new Element("textarea",{text:a.notes||"",events:{change:this._changeField}})),f.grab(new Element("input",{type:"checkbox",checked:!!a.completed||null,events:{change:this._changeField}})),g.grab(new seqta.ui.Button({defaultValue:tools.getIcon("delete"),extraClass:"flat",onClick:this._deleteRow}))):(b.set("text",a.goals||""),c.set("text",a.support||""),d.set("text",a.action||""),e.set("text",a.notes||""),f.set("html",a.completed?Locale.get("general.yes"):Locale.get("general.no")),g&&g.set("html",tools.getIcon("lock_outline"))),new Element("tr",{class:a.editable?"editable":"","data-id":a.id}).adopt(b,c,d,e,f,g)}.bind(this)));var a=new Element("table").adopt(new Element("thead").grab(new Element("tr").adopt(new Element("td",{class:"goals",html:Locale.get("goals.goal")}),new Element("td",{class:"support",html:Locale.get("goals.support")}),new Element("td",{class:"action",html:Locale.get("goals.action")}),new Element("td",{class:"notes",html:Locale.get("goals.notes",this._name)}),new Element("td",{class:"completed",html:Locale.get("goals.done")}),!this._readonly&&new Element("td",{class:"delete"}).grab(new seqta.ui.Button({defaultValue:tools.getIcon("add"),extraClass:"flat",onClick:this._addRow})))),this._elItemsBody);return new Element("div",{class:"student"}).adopt(new Element("div",{class:"notes"}).adopt(new Element("h2",{html:Locale.get("goals.notes",this._name)}),$(this._elNotes)),new Element("div",{class:"items"}).adopt(new Element("h2",{html:Locale.get("goals.goals")}),a))},_changeField:function(){this.setDirty(!0)},_addRow:function(){if(!this._readonly){var a=new Element("td",{class:"goals"}),b=new Element("td",{class:"support"}),c=new Element("td",{class:"action"}),d=new Element("td",{class:"notes"}),e=new Element("td",{class:"completed"}),f=new Element("td",{class:"delete"});a.grab(new Element("textarea")),b.grab(new Element("textarea")),c.grab(new Element("textarea")),d.grab(new Element("textarea")),e.grab(new Element("input",{type:"checkbox"})),f.grab(new seqta.ui.Button({defaultValue:tools.getIcon("delete"),extraClass:"flat",onClick:this._deleteRow})),this._elItemsBody.grab(new Element("tr",{class:"editable","data-uid":String.uniqueID()}).adopt(a,b,c,d,e,f)),this.setDirty(!0)}},_deleteRow:function(a){var b=$(a.target);(b.hasClass("editable")||(b=b.getParent("tr.editable")),b)&&(this._elDeleting=b,new seqta.ui.SlidePane({compact:!0,onYes:this._doDeleteRow}).showConfirm(Locale.get("goals.reallyDeleteRowT"),Locale.get("goals.reallyDeleteRow"),["yes","no"]))},_doDeleteRow:function(){this._elDeleting&&(this._elDeleting.dispose(),this.setDirty(!0))},save:function(){if(!this._readonly&&this.isDirty()){var a={mode:"save",goal:this._goal,student_notes:this._elNotes.get()};a.items=this._elItemsBody.getChildren("tr.editable").map(function(a){var b={goals:a.getElement("td.goals textarea").get("value"),support:a.getElement("td.support textarea").get("value"),action:a.getElement("td.action textarea").get("value"),notes:a.getElement("td.notes textarea").get("value")};return this._student&&(b.student=this._student),a.get("data-id")&&(b.id=a.get("data-id").toInt()),a.get("data-uid")&&(b.uid=a.get("data-uid")),a.getElement("td.completed input").get("checked")&&(b.completed=!0),b}),ajax.send(this.options.urls.goals,a,this._afterSave)}},_afterSave:function(a){if(a){for(var b,c=Object.keys(a),d=0;d<c.length;d++)(b=this._elItemsBody.getElement('tr.editable[data-uid="'+c[d]+'"]')).set("data-id",a[c[d]]),b.erase("data-uid");this.setDirty(!1)}}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){for(var b=["coneqt-s.page.goals","coneqt-p.page.goals"],c=0;c<b.length;c++)if(a[b[c]]&&"disabled"===a[b[c]].value)return;ajax.send("load/goals",{mode:"years"},function(a){var b="/goals/",c=function(a,b,c,d){a+=b,d&&(a=a+":"+d);var e={};e[a]=Locale.get("goals.pageTitle",b),Locale.define("en-AU","pages",e),seqta.chrome.registerPage(a,seqta.coneqt.page.Goals,{label:Locale.get("goals.pageTitle",b),order:c+1})};if("contact"===user.type)for(var d=0;d<a.length;d++){var e=a[d],f=b;if(1<a.length){f=f+e.id+"/";var g={};g[e.id]=e.name,Locale.define("en-AU","pages",g)}for(var h=0;h<e.years.length;h++)c(f,e.years[h],h,e.id)}else for(d=0;a&&d<a.length;d++)c(b,a[d],d)})})},!0),seqta.coneqt.page.Messages=new Class({Extends:seqta.base.Page,Binds:["draw","getToolbar","cleanup","_applySitesettings","_retrieveStudentData","_retrieveStaffData","_retrieveTutorData","_retrieveContactData"],options:{urls:{load:"load/message",save:"save/message",people:"load/message/people",staffCoords:"load/staff/coordinators",file:"load/file?type=message&file={id}"}},_viewer:null,_ptComposer:null,_settingsApplied:!1,_pendingDraw:!1,composeMessageEnabled:!1,initialize:function(a){this.parent(a),dataStore.retrieve("siteSettings",this._applySitesettings)},draw:function(){if(this._settingsApplied){this._pendingDraw=!1,this._ptComposer=this._ptComposer||new seqta.base.part.coneqtMessage.Composer(Object.merge({},this.options,{enableMany:{students:!1,staff:!0,contacts:!1},people:{students:this._retrieveStudentData,staff:this._retrieveStaffData,contacts:this._retrieveContactData,tutors:this._retrieveTutorData}})),this._viewer=this._viewer||new seqta.base.ComponentWrapper({component:SEQTATeachModules.messages.Viewer,props:{disallowCustomLabels:!0,composeMessageEnabled:this.composeMessageEnabled}});var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"messages"}).adopt(this._viewer).inject(a)}else this._pendingDraw=!0},getToolbar:function(){return[]},cleanup:function(){this._viewer&&this._viewer.cleanup(),this._ptComposer&&this._ptComposer.cleanup()},_applySitesettings:function(a){a["coneqt-s.messages.students.enabled"]&&"disabled"===a["coneqt-s.messages.students.enabled"].value||a["coneqt-p.messages.students.enabled"]&&"disabled"===a["coneqt-p.messages.students.enabled"].value?this._retrieveStudentData=null:this.composeMessageEnabled=!0,a["coneqt-s.messages.contacts.enabled"]&&"disabled"===a["coneqt-s.messages.contacts.enabled"].value||a["coneqt-p.messages.contacts.enabled"]&&"disabled"===a["coneqt-p.messages.contacts.enabled"].value?this._retrieveContactData=null:this.composeMessageEnabled=!0,a["coneqt-s.messages.staff.enabled"]&&"disabled"===a["coneqt-s.messages.staff.enabled"].value||a["coneqt-p.messages.staff.enabled"]&&"disabled"===a["coneqt-p.messages.staff.enabled"].value?this._retrieveStaffData=null:this.composeMessageEnabled=!0,a["coneqt-s.messages.tutors.enabled"]&&"disabled"===a["coneqt-s.messages.tutors.enabled"].value||a["coneqt-p.messages.tutors.enabled"]&&"disabled"===a["coneqt-p.messages.tutors.enabled"].value?this._retrieveTutorData=null:this.composeMessageEnabled=!0,this._settingsApplied=!0,this._pendingDraw&&this.draw()},_retrieveStudentData:function(a){a&&"function"===typeOf(a)&&ajax.send(this.options.urls.people,{mode:"student"},function(b){for(var c=0;c<b.length;c++)b[c].xx_value=b[c].id;a(seqta.coneqt.common.postProcessStudents(b))})},_retrieveStaffData:function(a){a&&"function"===typeOf(a)&&ajax.send(this.options.urls.people,{mode:"staff"},function(b){for(var c=0;c<b.length;c++)b[c].xx_value=b[c].id;a(b)})},_retrieveTutorData:function(a){a&&"function"===typeOf(a)&&ajax.send(this.options.urls.people,{mode:"tutor"},function(b){for(var c=0;c<b.length;c++)b[c].xx_value=b[c].id;a(b)})},_retrieveContactData:function(a){a&&"function"===typeOf(a)&&ajax.send(this.options.urls.people,{mode:"contact"},function(b){for(var c=0;c<b.length;c++)b[c].xx_value=b[c].id;a(b)})}}),msg.register("chrome.ready",function(){msg.register("datastore.preload",function(){dataStore.retrieve("siteSettings",function(a){a["coneqt-s.messages.enabled"]&&"disabled"===a["coneqt-s.messages.enabled"].value||a["coneqt-p.messages.enabled"]&&"disabled"===a["coneqt-p.messages.enabled"].value||seqta.chrome.registerPage("/messages",seqta.coneqt.page.Messages,{label:Locale.get("pages.messages")})})})},!0),seqta.coneqt.page.MyEd=new Class({Extends:seqta.base.Page,options:{},Binds:["getToolbar","draw","cleanup"],initialize:function(a){this.parent(a),this.draw()},getToolbar:function(){return[]},draw:function(){this.getToolbar();const a=seqta.chrome.getContentArea();a.empty();var b=SEQTATeachModules.lti;const c=b.applications,e=(0,b.getApplicationLaunchUrl)(c.myedonline,["contextType=CourseOffering"]);a.grab(new seqta.ui.Frame({dangerouslyAllowSameOriginAccessEnableAtYourOwnPeril:!0,extraClass:"myEd",autoSize:!1,src:e}))},cleanup:function(){}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){a["global.myed"]&&"disabled"===a["global.myed"].value||"contact"===user.type||seqta.chrome.registerPage("/myed",seqta.coneqt.page.MyEd,{label:Locale.get("pages.myed")})})},!0),seqta.coneqt.page.Notices=new Class({Extends:seqta.base.Page,options:{urls:{load:"load/notices"},defaultColour:"#ccc"},Binds:["draw","getToolbar","_receiveLabels","_retrieveData","_receiveData","_toggleListMode","_render","_drawNotice","_changeLabels","_changeDate"],_element:null,_notices:null,_labels:null,_date:null,_dateSelector:null,_labelList:null,_labelListC:null,_elDisplayModeToggle:null,_filterLabels:null,initialize:function(a){this.setOptions(a),this._date=new Date},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"notices"}).inject(a),this._retrieveData()},getToolbar:function(){return this._labelListC=this._labelListC||new Element("span"),this._elDisplayModeToggle=this._elDisplayModeToggle||new seqta.ui.ButtonToggle({defaultValue:Locale.get("notices.displayList"),extraClass:"labelled",onToggle:function(a){user.savePreference("notices.display",a?"list":"standard"),this._toggleListMode(a)}.bind(this)}),msg.register("user.settings.loaded",function(){var a=user.getPreference("notices.display"),b=!!a&&"list"===a.value;this._elDisplayModeToggle.setToggled(b),this._toggleListMode(b),this._labels?this._receiveLabels(this._labels):ajax.send(this.options.urls.load,{mode:"labels"},this._receiveLabels)}.bind(this),!0),this._dateSelector=new seqta.ui.ButtonCalendar({onChange:this._changeDate}),[this._labelListC,this._elDisplayModeToggle,this._dateSelector]},_toggleListMode:function(a){this._element&&(a?this._element.addClass("list").removeClass("grid"):this._element.removeClass("list").addClass("grid"))},_receiveLabels:function(a){this._labels=a,this._filterLabels=this._labels.map(function(a){return a.id});var b=null,c=user.getPreference("notices.filters");null!==(c=c&&c.value)&&(b=c.split(" ").map(Number),this._filterLabels=b),this._labelList=new seqta.ui.ButtonChecklist({allButton:!0,items:this._labels.map(function(a){var d=!1;return(null===c||-1!==b.indexOf(a.id))&&(d=!0),{value:a.id,label:a.title,checked:d}}),onChange:this._changeLabels}),this._labelListC.grab(this._labelList),this._notices&&this._labels&&this._render()},_retrieveData:function(){ajax.send(this.options.urls.load,{date:this._date.print("sqlDate")},this._receiveData)},_receiveData:function(a){this._notices=a,this._notices&&this._labels&&this._render()},_render:function(){var a=[];this._notices.forEach(function(b){(this._filterLabels.length===this._labels.length||this._filterLabels.contains(b.label))&&a.push(this._drawNotice(b))}.bind(this)),a.length||a.push(new Element("div",{class:"note",html:Locale.get("notices.noNotices")})),this._element.empty(),this._element.adopt(a)},_drawNotice:function(a){a.colour||this.options.defaultColour;var c=new Element("div",{class:"notice",style:a.colour?"--colour: "+a.colour:"","data-id":a.id});return c.adopt(new Element("h2",{text:a.title}),new Element("div",{class:"label",text:a.label_title||Locale.get("notices.noLabelName")}),new Element("div",{class:"staff",text:a.staff}),new seqta.ui.Frame({dangerouslyAllowSameOriginAccessEnableAtYourOwnPeril:!0,dangerouslyAllowUnfilteredContentEnableAtYourOwnPeril:!0,extraClass:"contents"},a.contents)),c},_changeLabels:function(a){this._filterLabels=a||[];for(var b="",c=0;c<this._filterLabels.length;c++)b=b+this._filterLabels[c]+" ";user.savePreference("notices.filters",b.trim()),this._render()},_changeDate:function(a){this._date=a,this._retrieveData()}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){for(var b=["coneqt-s.page.notices","coneqt-p.page.notices"],c=0;c<b.length;c++)if(a[b[c]]&&"disabled"===a[b[c]].value)return;seqta.chrome.registerPage("/notices",seqta.coneqt.page.Notices,{label:Locale.get("pages.notices")})})},!0),seqta.coneqt.page.Portals=new Class({Extends:seqta.base.Page,options:{urls:{load:"load/portals",file:null},conversationUrls:{load:"load/conversation",save:"save/conversation"},fileDefaults:{type:"portal"}},Binds:["draw","_receiveLabels","_retrieveData","_receiveData","_render","cleanup"],_element:null,_iframe:null,_conversation:null,_portal:null,_joData:null,_elPortalPage:null,_themeOverride:null,initialize:function(a,b,c){this._portal=c&&c.split("/").getLast();const d=user.getPreference("creator_theme");this._themeOverride=d&&d.value},cleanup:function(){this._joData&&this._joData.is_power_portal&&this._elPortalPage.cleanup()},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"portals"}).inject(a),this._retrieveData()},_retrieveData:function(){var a={};this._portal?a.id=this._portal:a.splash=!0,ajax.send(this.options.urls.load,a,this._receiveData)},_receiveData:function(a){this._joData=a,this._render()},_render:function(){var a,b=null,c=null,d=null;if(this._joData.url?b=this._joData.url.urlify().replace(/^http:\/\//g,"//"):this._joData.files=this._joData.files||[],c={autoSize:!1,dangerouslyAllowSameOriginAccessEnableAtYourOwnPeril:!0,dangerouslyAllowUnfilteredContentEnableAtYourOwnPeril:!0,extraClass:(a=this._joData.conversation_id&&0<=this._joData.conversation_id)?"comments":"",frameClass:"portal"+(this._joData.inherit_styles?" userHTML":""),src:b||void 0,macro:{browser:{fileDefaults:{type:"portal"}}}},this._joData.inherit_styles||(c.stylesheets=[]),a&&(this._conversation=new seqta.base.part.Conversation({context:"portal",context_id:this._joData.id,urls:this.options.conversationUrls},this._joData.conversation_id)),this._joData.is_power_portal){var e=new Element("div",{class:"portalPageView"});SEQTATeachModules.createConeqtPortalViewerBuilder().withPortal(this._joData).withClassName("powerPortalPage").withUser({id:user.id,type:user.type}).withThemeOverride(this._themeOverride).build().then(a=>{this._elPortalPage=a,e.adopt(this._elPortalPage,this._conversation),this._element.empty(),this._element.adopt(e)}).catch(()=>$alertSubtle(Locale.get("portals.errorLoadingPortal")))}else d=new seqta.ui.Frame(c,this._joData.contents,this._joData.files),this._element.empty(),this._element.adopt(d,this._conversation)}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){for(var b=["coneqt-s.page.portals.name","coneqt-p.page.portals.name"],c=0;c<b.length;c++)a[b[c]]&&a[b[c]].value&&Locale.define("en-AU","pages",{portals:a[b[c]].value});msg.register("user.settings.loaded",function(){ajax.send("load/portals",{},function(a){var b,c,d;if(a.length)for(var e=0;e<a.length;e++)(d={})[b="/portals/"+(c=a[e]).uuid]=c.label,Locale.define("en-AU","pages",d),seqta.chrome.registerPage(b,seqta.coneqt.page.Portals,{label:c.label,order:c.priority,icon:c.icon?`portal/${c.icon}`:"workspace/portals"})})},!0)})},!0),seqta.coneqt.page.Reports=new Class({Extends:seqta.base.Page,options:{urls:{load:"load/reports"}},Binds:["draw","_receiveData","_drawReport"],_element:null,_student:null,initialize:function(a,b,c){this.parent(a);var d=c.split("/").getLast().split(":");this._student=d[1]},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"reports"}).inject(a),dataStore.retrieve("siteSettings",function(a){var b=a["coneqt-s.reports.message"]||a["coneqt-p.reports.message"];b&&b.value&&this._element.grab(new Element("div",{class:"message",html:b.value}),"top")}.bind(this)),ajax.send(this.options.urls.load,{student:this._student},this._receiveData)},_receiveData:function(a){var b=a.map(this._drawReport);b.length||b.push(new Element("div",{class:"note",html:Locale.get("reports.noReports")})),this._element.adopt(b)},_drawReport:function(a){var b=new Element("a",{class:"report",href:Configuration.fileURL.substitute({uuid:a.uuid,type:"report"}),target:"_blank"}).adopt(new Element("div",{class:"year",text:a.year}),new Element("div",{class:"term",text:a.terms}),new Element("div",{class:"type",text:a.types}),new Element("div",{class:"date",text:a.created_date.toDate().print()}));return new Element("div",{class:"item"}).grab(b)}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){for(var b=["coneqt-s.page.reports","coneqt-p.page.reports"],c=0;c<b.length;c++)if(a[b[c]]&&"disabled"===a[b[c]].value)return;"contact"===user.type?ajax.send("load/reports",{list:!0},a=>{for(var b=0;b<a.length;b++){var c=a[b],d=Locale.get("pages.reports")+": "+c.name,e={};e[":"+c.id]=d,Locale.define("en-AU","pages",e),seqta.chrome.registerPage("/reports/:"+c.id,seqta.coneqt.page.Reports,{label:d})}}):seqta.chrome.registerPage("/reports",seqta.coneqt.page.Reports,{label:Locale.get("pages.reports")})})},!0),seqta.coneqt.page.Settings=new Class({Extends:seqta.base.Page,options:{urls:{savePassword:"save/password",profileLoad:"load/profile",recover:"recover",loadCreatorThemes:"themes/list",starCreatorTheme:"themes/star"}},Binds:["draw","_drawPassword","_changePassword","_savePassword","_postSavePassword","_connectMobileApp","_drawMobileAppsPrefs","_drawGeneralPrefs","_drawCreatorThemeBrowser","_selectAudioPref","_selectCreatorTheme","_toggleCreatorThemeBrowser","_starCreatorTheme","_loadProfile"],_element:null,_elPassword:null,_elMobileApps:null,_elGeneral:null,_elCreatorThemeBrowser:null,_elCreatorThemeBrowserC:null,_elCurrentPassword:null,_elPasswordNew:null,_elPasswordConfirm:null,_elPasswordError:null,_elPasswordSave:null,_elPasswordComplexity:null,_elConnectMobileAppButton:null,_defaultCreatorTheme:"8f8ce53c-ec1c-45a8-ab46-5e4a62d3604d",_selectedCreatorTheme:null,_creatorThemeBrowserParams:null,initialize:function(a){this.parent(a),this._creatorThemeBrowserParams={onSelect:this._selectCreatorTheme,showTitle:!1,allowStarring:!0,onToggleStar:this._starCreatorTheme,backgroundImageURL:function(a){return"url('/seqta/"+("contact"===user.type?"parent":"student")+"/load/file?type=theme&file={"+a+"}')"}.bind(this)}},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._elPassword=new Element("div",{class:"password"}),this._elMobileApps=new Element("div",{class:"apps"}),this._elGeneral=new Element("div",{class:"general"}),this._element=new Element("div",{class:"settings"}).adopt(this._elPassword,this._elMobileApps,this._elGeneral).inject(a);let b=tools.func.createConcurrentHandler(["settings","creator"],this._drawGeneralPrefs);msg.register("user.settings.loaded",b.settings,!0),ajax.send(this.options.urls.loadCreatorThemes,{},b.creator),ajax.send(this.options.urls.profileLoad,{},this._loadProfile)},_loadProfile:function(a){a.app_link&&this._drawMobileAppsPrefs(a),a.password_editable&&this._drawPassword()},_drawPassword:function(){this._elCurrentPassword=this._elCurrentPassword||new seqta.ui.ShortText({type:"password",placeholder:Locale.get("settings.authentication.currentPasswordPlaceholder")}),this._elPasswordNew=this._elPasswordNew||new seqta.ui.ShortText({type:"password",onChange:this._changePassword}),this._elPasswordConfirm=this._elPasswordConfirm||new seqta.ui.ShortText({type:"password",placeholder:Locale.get("settings.authentication.passwordConfirmPlaceholder"),onChange:this._changePassword}),this._elPasswordError=new Element("div",{class:"error",html:Locale.get("settings.authentication.error.mismatchedPasswords"),styles:{visibility:"hidden"}}),this._elPasswordComplexity=new Element("div",{class:"passwordContainer"}).adopt(new Element("div",{class:"field passwordComplexity"}).adopt(new Element("label",{text:Locale.get("settings.authentication.passwordComplexityLabel")}),new Element("div",{text:Locale.get("settings.authentication.passwordComplexity")})),new Element("div",{class:"field passwordWarning"}).adopt(new Element("label",{text:Locale.get("settings.authentication.passwordWarningLabel")}),new Element("div",{class:"passwordWarningText"})),new Element("div",{class:"field passwordSuggestions"}).adopt(new Element("label",{text:Locale.get("settings.authentication.passwordSuggestionsLabel")}),new Element("div",{class:"passwordSuggestionsText"}))),this._elPasswordSave=this._elPasswordSave||new seqta.ui.Button({defaultValue:Locale.get("settings.authentication.save"),onClick:this._savePassword}),this._elPasswordSave.disable(),this._elPasswordNew.set(""),this._elPasswordConfirm.set(""),this._elPassword.adopt(new Element("h2",{html:Locale.get("settings.password")}),new Element("div",{class:"field password"}).adopt(new Element("label",{html:Locale.get("settings.authentication.password")}),this._elPasswordNew),new Element("div",{class:"field passwordConfirm"}).adopt(new Element("label",{html:Locale.get("settings.authentication.passwordConfirm")}),this._elPasswordConfirm),this._elPasswordError,new Element("div",{class:"field passwordComplexityError",text:Locale.get("settings.authentication.passwordComplexity")}),this._elPasswordComplexity,new Element("div",{class:"field currentPassword"}).adopt(new Element("label",{html:Locale.get("settings.authentication.currentPassword")}),this._elCurrentPassword),this._elPasswordSave),this._elPassword.getElement(".field.password input").addEventListener("keyup",tools.newPasswordComplexityListener)},_changePassword:function(){var a=this._elPasswordNew.get(),b=this._elPasswordConfirm.get();return this._elPasswordSave.enable(),a&&b?a===b?void this._elPasswordError.setStyle("visibility","hidden"):void this._elPasswordError.setStyle("visibility","visible"):void this._elPasswordError.setStyle("visibility","hidden")},_savePassword:function(){let a=this._elCurrentPassword.get(),b=this._elPasswordNew.get(),c=this._elPasswordConfirm.get();return b&&c?b===c?8>b.length||64<b.length?void $alertSubtle(Locale.get("settings.authentication.error.failedPasswordComplexity"),Locale.get("settings.authentication.passwordComplexity")):void ajax.send(this.options.urls.savePassword,{password:b,currentPassword:a},this._postSavePassword):void $alertSubtle(Locale.get("settings.authentication.error.error"),Locale.get("settings.authentication.error.mismatchedPasswords")):void $alertSubtle(Locale.get("settings.authentication.error.error"),Locale.get("settings.authentication.error.blankPassword"))},_postSavePassword:function(a){a.success?(this._elPasswordSave.disable(),$alertSubtle(Locale.get("settings.authentication.savedT"),Locale.get("settings.authentication.saved"))):$alertSubtle(Locale.get("settings.authentication.error.error"),Locale.get("settings.authentication.error.passwordIncorrect"))},_connectMobileApp:function(a){0<=["ios","android"].indexOf(Browser.platform)||(a.stop(),this._elConnectMobileAppButton.hide(),ajax.send(this.options.urls.recover,{mode:"request",username:user.userName,email:user.userEmail,app:!0},function(){}.bind(this)),new Element("div",{text:Locale.get("settings.app.emailed").replace("{email}",user.userEmail),class:"emailed"}).inject(this._elConnectMobileAppButton,"after"))},_drawMobileAppsPrefs:function(a){if(!tools.isMobileApp){this._elMobileApps.adopt(new Element("h2",{html:Locale.get("settings.app.label")}));var b=new Element("div",{class:"links"}).inject(this._elMobileApps);Configuration.iTunesLink&&b.adopt(new Element("a",{target:"_blank",href:Configuration.iTunesLink}).adopt(new Element("img",{src:"//static.seqta.com.au/img/appstore.png"}))),Configuration.googlePlayLink&&b.adopt(new Element("a",{href:Configuration.googlePlayLink,target:"_blank"}).adopt(new Element("img",{src:"//static.seqta.com.au/img/playstore.png"}))),0<=["ios","android"].indexOf(Browser.platform)||user.userEmail?this._elMobileApps.adopt(this._elConnectMobileAppButton=new Element("a",{href:a.app_link,html:Locale.get("settings.app.connect"),events:{click:this._connectMobileApp}})):this._elMobileApps.adopt(new Element("div",{class:"warning",text:Locale.get("settings.app.noemail")})),this._elMobileApps.adopt(new Element("div",{class:"label",text:Locale.get("settings.app.url").replace("{url}",window.location.origin)}),new Element("div",{class:"label",text:Locale.get("settings.app.username").replace("{username}",user.userName)})),user.userEmail&&this._elMobileApps.adopt(new Element("div",{class:"label",text:Locale.get("settings.app.email").replace("{email}",user.userEmail)}))}},_drawGeneralPrefs:function(a,b){var c=user.getPreference("alerts.audio"),d="disabled"!==(c=(c=c&&c.value)||"disabled");let e=user.getPreference("creator_theme");(e=e&&e.value)&&b&&0===b.filter(function(a){return a.uuid===e}).length&&(e=this._defaultCreatorTheme),this._selectedCreatorTheme=e||this._defaultCreatorTheme,this._creatorThemeBrowserParams.themes=b,this._drawCreatorThemeBrowser(this._selectedCreatorTheme),this._elCreatorThemeBrowserC=new Element("div",{class:"creatorTheme"}),this._elCreatorThemeBrowser.enable(!!e),this._elGeneral.adopt(new Element("h2",{html:Locale.get("settings.general")}),new Element("div",{class:"audio"}).adopt(new Element("label",{html:Locale.get("settings.audio.label")}),new seqta.ui.Pillbox({onChange:this._selectAudioPref},{enabled:Locale.get("settings.audio.enabled"),disabled:Locale.get("settings.audio.disabled")},d?"enabled":"disabled")),new Element("h2",{class:"preSpaced",html:Locale.get("settings.richContent")}),this._elCreatorThemeBrowserC.adopt(new seqta.ui.Checkbox({defaultValue:e,label:Locale.get("settings.creatorThemeOverride"),boxClass:"override",onChange:this._toggleCreatorThemeBrowser}).getBox(),this._elCreatorThemeBrowser))},_drawCreatorThemeBrowser:function(a){this._creatorThemeBrowserParams.selectedUUID=a,this._elCreatorThemeBrowser=new seqta.coneqt.ThemeBrowser(this._creatorThemeBrowserParams),this._elCreatorThemeBrowserC&&this._elCreatorThemeBrowserC.adopt(this._elCreatorThemeBrowser)},_selectAudioPref:function(a){user.savePreference("alerts.audio",a),"enabled"===a?audio.enable():audio.disable()},_selectCreatorTheme:function(a){this._creatorThemeBrowserParams.selectedUUID=a,this._elCreatorThemeBrowser&&this._elCreatorThemeBrowser.render(this._creatorThemeBrowserParams),this._selectedCreatorTheme=a,user.savePreference("creator_theme",a)},_toggleCreatorThemeBrowser:function(a){a?user.savePreference("creator_theme",this._selectedCreatorTheme||this._defaultCreatorTheme):user.savePreference("creator_theme",""),this._elCreatorThemeBrowser.enable(a)},_starCreatorTheme:function(a,b){ajax.send(this.options.urls.starCreatorTheme,{uuid:a,value:b},function(){this._creatorThemeBrowserParams.themes.filter(b=>b.uuid===a)[0].starred=b,this._elCreatorThemeBrowser&&this._elCreatorThemeBrowser.render(this._creatorThemeBrowserParams)}.bind(this))}}),msg.register("chrome.ready",function(){seqta.chrome.registerPage("/settings",seqta.coneqt.page.Settings,{label:Locale.get("pages.settings")})},!0),seqta.coneqt.page.Synergetic=new Class({Extends:seqta.base.Page,options:{urls:{authenticate:"synergeticCommunity/authenticate"}},Binds:["cleanup","draw","_authenticate","_handleResponse"],_element:null,_iframe:null,_synergeticPage:null,initialize:function(a,b,c){this._synergeticPage=c&&c.split(":").getLast()},cleanup:function(){this._iframe.destroy(),this._element.destroy()},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"synergetic"}).inject(a),this._authenticate()},_authenticate:function(){ajax.send(this.options.urls.authenticate,{page:this._synergeticPage},this._handleResponse)},_handleResponse:function(a){return a.url?(this._iframe=new Element("iframe",{src:a.url}),void this._element.grab(this._iframe)):(this._element.set("html",Locale.get("synergetic.error")),void this._element.addClass("error"))}}),msg.register("chrome.ready",()=>{dataStore.retrieve("siteSettings",a=>{if(a["synergetic.community.url"]&&a["synergetic.community.url"].value){for(var b=["coneqt-s.synergetic.community.pages.intro.name","coneqt-p.synergetic.community.pages.intro.name"],c=0;c<b.length;c++)a[b[c]]&&a[b[c]].value&&Locale.define("en-AU","synergetic",{page:{intro:a[b[c]].value}});[{name:"absences",setting:"coneqt-p.synergetic.community.pages.absences",path:"synergetic:absences",usertype:"contact"},{name:"absences",setting:"coneqt-s.synergetic.community.pages.absences",path:"synergetic:absences",usertype:"student"},{name:"accommodation",setting:"coneqt-p.synergetic.community.pages.accommodation",path:"synergetic:accommodation",usertype:"contact"},{name:"accommodation",setting:"coneqt-s.synergetic.community.pages.accommodation",path:"synergetic:accommodation",usertype:"student"},{name:"applications",setting:"coneqt-p.synergetic.community.pages.applications",path:"synergetic:applications",usertype:"contact"},{name:"applications",setting:"coneqt-s.synergetic.community.pages.applications",path:"synergetic:applications",usertype:"student"},{name:"contacts",setting:"coneqt-p.synergetic.community.pages.contacts",path:"synergetic:contacts",usertype:"contact"},{name:"contactus",setting:"coneqt-p.synergetic.community.pages.contactus",path:"synergetic:contactus",usertype:"contact"},{name:"details",setting:"coneqt-p.synergetic.community.pages.details",path:"synergetic:details",usertype:"contact"},{name:"docs",setting:"coneqt-p.synergetic.community.pages.docs",path:"synergetic:docs",usertype:"contact"},{name:"docs",setting:"coneqt-s.synergetic.community.pages.docs",path:"synergetic:docs",usertype:"student"},{name:"electives",setting:"coneqt-p.synergetic.community.pages.electives",path:"synergetic:electives",usertype:"contact"},{name:"electives",setting:"coneqt-s.synergetic.community.pages.electives",path:"synergetic:electives",usertype:"student"},{name:"events",setting:"coneqt-p.synergetic.community.pages.events",path:"synergetic:events",usertype:"contact"},{name:"events",setting:"coneqt-s.synergetic.community.pages.events",path:"synergetic:events",usertype:"student"},{name:"excursions",setting:"coneqt-p.synergetic.community.pages.excursions",path:"synergetic:excursions",usertype:"contact"},{name:"excursions",setting:"coneqt-s.synergetic.community.pages.excursions",path:"synergetic:excursions",usertype:"student"},{name:"finance",setting:"coneqt-p.synergetic.community.pages.finance",path:"synergetic:finance",usertype:"contact"},{name:"interviews",setting:"coneqt-p.synergetic.community.pages.interviews",path:"synergetic:interviews",usertype:"contact"},{name:"intro",setting:"coneqt-p.synergetic.community.pages.intro",path:"synergetic:intro",usertype:"contact"},{name:"intro",setting:"coneqt-s.synergetic.community.pages.intro",path:"synergetic:intro",usertype:"student"},{name:"paymentplans",setting:"coneqt-p.synergetic.community.pages.paymentplans",path:"synergetic:paymentplans",usertype:"contact"},{name:"payments",setting:"coneqt-p.synergetic.community.pages.payments",path:"synergetic:payments",usertype:"contact"},{name:"results",setting:"coneqt-p.synergetic.community.pages.results",path:"synergetic:results",usertype:"contact"},{name:"results",setting:"coneqt-s.synergetic.community.pages.results",path:"synergetic:results",usertype:"student"},{name:"selfassessment",setting:"coneqt-s.synergetic.community.pages.selfassessment",path:"synergetic:selfassessment",usertype:"student"},{name:"timetable",setting:"coneqt-p.synergetic.community.pages.timetable",path:"synergetic:timetable",usertype:"contact"},{name:"timetable",setting:"coneqt-s.synergetic.community.pages.timetable",path:"synergetic:timetable",usertype:"student"},{name:"managestoredcards",setting:"coneqt-p.synergetic.community.pages.managestoredcards",path:"synergetic:managestoredcards",usertype:"contact"}].forEach(b=>{b.usertype===user.type&&a[b.setting]&&a[b.setting].value&&"enabled"===a[b.setting].value&&seqta.chrome.registerPage("/"+b.path,seqta.coneqt.page.Synergetic,{label:Locale.get("synergetic.page."+b.name)})})}})}),seqta.coneqt.page.Timetable=new Class({Extends:seqta.base.Page,options:{defaultColour:"#444444",urls:{load:"load/timetable",print:"print/timetable",events:"events/load"}},Binds:["draw","_receiveSettings","_getAllowedInviteeTypes","_getSiteSetting","_drawQuickbar","cleanup","_partialCleanup","getToolbar","_listPersons","_selectPerson","_getPersonItems","_retrieveData","_receiveData","_getCurrentDays","_process","_drawEntries","_drawEventEntry","_drawClassEntry","_drawTutorialEntry","_navigate","_changeDate","_createEntry","_removeNewEntry","_clickEntry","_dropEntry","_showQuickbar","_showClassQuickbar","_showEventQuickbar","_hideQuickbar","_print"],_element:null,_container:null,_quickbar:null,_date:null,_data:null,_events:null,_entryID:null,_cycles:null,_calendar:null,_mailtoPrefix:null,_redrawCleaners:null,_finaliseCleaners:null,_inviteeTypes:null,_eventsAllowed:!0,_newEntry:null,_person:null,_showNotes:!1,_scale:null,initialize:function(a){this.parent(a),this._redrawCleaners=[],this._finaliseCleaners=[],this._person={id:user.userID,type:user.type},this._date=new Date,this._scale=0,user.getPreference("calendar.scale")&&(this._scale=user.getPreference("calendar.scale").value),this._finaliseCleaners.push(msg.register("calendar.cleaner",this._redrawCleaners.push.bind(this._redrawCleaners),!1,!0)),this._finaliseCleaners.push(msg.register("timetable.reload",this._retrieveData,!1,!0)),this._finaliseCleaners.push(msg.register("calendar.event.cancel",this._removeNewEntry,!1,!0))},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"timetablepage"}).grab(new Element("div",{class:"note",html:Locale.get("timetable.clickForDetails")})),this._container=new Element("div",{class:"container"}).inject(this._element),this._element.inject(a),dataStore.retrieve("siteSettings",this._receiveSettings),this._drawQuickbar()},_receiveSettings:function(a){var b=this._getSiteSetting.bind(void 0,a),c="contact"===user.type?"coneqt-p":"coneqt-s";this._mailtoPrefix=b(c+".mailto")||"mailto:?bcc=";var d=b(c+".timetable.message");d&&this._element.addClass("hasMessage").grab(new Element("div",{class:"message",html:d}),"top"),this._inviteeTypes=this._getAllowedInviteeTypes(b,c),this._eventsAllowed="disabled"!==b(c+".events.enabled"),msg.register("user.settings.loaded",this._retrieveData,!0)},_getAllowedInviteeTypes:function(a,b){return{staff:"enabled"===a(b+".events.staff.enabled","enabled"),students:"enabled"===a(b+".events.students.enabled","enabled"),contacts:"enabled"===a(b+".events.contacts.enabled","enabled"),tutors:"enabled"===a(b+".events.tutors.enabled","enabled")}},_getSiteSetting:function(a,b,c){var d=a[b];return d&&d.value||c||null},_drawQuickbar:function(){this._quickbar=this._quickbar||new seqta.ui.Quickbar({}),this._finaliseCleaners.push(msg.register("calendar.quickbar.hide",this._hideQuickbar,!1,!0)),this._finaliseCleaners.push(msg.register("calendar.quickbar.event",this._showEventQuickbar,!1,!0)),this._finaliseCleaners.push(msg.register("calendar.quickbar.class",this._showClassQuickbar,!1,!0))},cleanup:function(){this._partialCleanup(),this._finaliseCleaners.forEach(function(a){"function"==typeof a&&a()}),delete this._finaliseCleaners,delete this._redrawCleaners,this._calendar&&this._calendar.cleanup()},_partialCleanup:function(){this._redrawCleaners.forEach(function(a){"function"==typeof a&&a()}),this._redrawCleaners.empty()},getToolbar:function(){return this._toolbarEls=this._toolbarEls||{filter:new seqta.ui.ButtonChecklist({allButton:!0,updateLabel:()=>this._toolbarEls?Locale.get("timetable.viewSelectorLabeller",[this._toolbarEls.filter.get()]):Locale.get("timetable.viewSelectorLabeller","all"),items:[{value:"classes",label:Locale.get("timetable.viewClasses"),checked:!0},{value:"tutorials",label:Locale.get("timetable.viewTutorials"),checked:!0},{value:"events",label:Locale.get("timetable.viewEvents"),checked:!0}],onChange:this._process}),notes:new seqta.ui.ButtonToggle({defaultValue:Locale.get("timetable.notesVisible"),extraClass:"labelled",onToggle:function(a){user.savePreference("timetable.notes.visible",a?"enabled":"disabled"),this._showNotes=!!a,msg.send("calendar.notes.toggle",!!a)}.bind(this)}),print:new seqta.ui.Button({defaultValue:Locale.get("general.print"),onClick:this._print}),date:new seqta.ui.ButtonCalendar({onChange:this._changeDate})},this._toolbarEls.person||"contact"!==user.type||(this._toolbarEls.personWrapper=new Element("span"),ajax.send("load/timetable",{list:!0},this._listPersons)),this._toolbarEls.print["student"===this._person.type?"enable":"disable"](),msg.register("user.settings.loaded",function(){var a=user.getPreference("timetable.notes.visible");this._showNotes=!(a&&"disabled"===a.value),this._toolbarEls.notes.setToggled(this._showNotes)}.bind(this)),[this._toolbarEls.filter,this._toolbarEls.notes,this._toolbarEls.personWrapper,this._toolbarEls.print,this._toolbarEls.date]},_listPersons:function(a){var b=this._getPersonItems(user,a);this._toolbarEls.person=new seqta.ui.ButtonMenu({items:b,onSelect:this._selectPerson,defaultValue:b[0].label}),this._toolbarEls.personWrapper.grab(this._toolbarEls.person),this._selectPerson(b[0],this._toolbarEls.person.toElement(),this._toolbarEls.person)},_selectPerson:function(a,b,c){this._person.id!==a.id&&(c.setLabel(a.label),this._person=a,this._toolbarEls.print["student"===this._person.type?"enable":"disable"](),this._retrieveData())},_getPersonItems:function(a,b){var c=[];return c.append(b.map(function(a){return{id:a.id,type:"student",label:a.name}})),c.push({id:a.userID,type:a.type,label:Locale.get("timetable.your")}),c},_retrieveData:function(){var a=new Date(this._date).startOfWeek().addDays(1),b=tools.func.createConcurrentHandler(["timetable","events"],this._receiveData);"student"===this._person.type?ajax.send(this.options.urls.load,{from:a.print("sqlDate"),until:new Date(a).addDays(6).print("sqlDate"),student:this._person.id},b.timetable):b.timetable(),ajax.send(this.options.urls.events,{dateFrom:a.print("sqlDate"),dateTo:new Date(a).addDays(6).print("sqlDate"),person:this._person.id,personType:this._person.type},b.events)},_receiveData:function(a,b){this._data=a&&a.items,this._cycles=a&&a.cycles,this._events=b,this._process()},_getCurrentDays:function(){for(var a=[],b=new Date(this._date).startOfWeek().addDays(1),c=new Date(b).addDays(6),d=b.daysBetween(c),e=0;e<=d;e++){for(var f=new Date(b),g="",h=f.print("sqlDate"),k=f.print("l"),l=f.print("D j M"),m=this._cycles&&this._cycles[h],n=0;m&&n<m.length;n++)m[n]&&m[n]!==k&&(g.length&&(g+=", "),g+=m[n]);a.push({date:f,label:Locale.get("timetable.dayTitle",[l,g])}),b.addDays(1)}return a},_process:function(){this._partialCleanup();var a=this._toolbarEls.filter.get();this._calendar?(this._calendar.setDays(this._getCurrentDays()),this._calendar.setReadonly(!a.contains("events")||!this._eventsAllowed),this._calendar.clearEntries(),this._hideQuickbar()):(this._calendar=new seqta.ui.DailyCalendar({idField:"calendarid",addColumnSpace:!0,onCreateEntry:this._createEntry,onNavigate:this._navigate,onScale:this._process,onEditEntry:this._clickEntry,onDrag:msg.send.bind(null,"calendar.quickbar.hide"),onDrop:this._dropEntry,highlightWeekends:!0,showCurrentTime:!0,currentScale:this._scale.toInt()},this._getCurrentDays()),this._container.adopt(this._calendar),this._calendar.setReadonly(!a.contains("events")||!this._eventsAllowed),this._calendar.scrollToDefault()),this._drawEntries(a)},_drawEntries:function(a){this._data&&(a.contains("classes")||a.contains("tutorials"))&&this._data.forEach(function(b){"class"===b.type&&a.contains("classes")?this._drawClassEntry(b):"tutorial"===b.type&&a.contains("tutorials")&&this._drawTutorialEntry(b)}.bind(this)),a.contains("events")&&this._events.forEach(this._drawEventEntry),this._redrawCleaners.push(msg.register("calendar.event.updated.new",tools.func.compose(this._drawEventEntry,this._removeNewEntry),!1,!0))},_drawEventEntry:function(a){var b=new Date(this._date).startOfWeek();return new seqta.base.part.calendar.entry.Event({dateRange:[b.print("sqlDate"),new Date(b).addDays(7).print("sqlDate")],mutable:a.event.owner_type===user.type&&a.event.owner_id===user.userID,person:this._person,inviteeTypes:this._inviteeTypes,urls:{save:"events/save"}},this._calendar,a)},_drawClassEntry:function(a){return new seqta.coneqt.part.timetable.entry.Class({inviteeTypes:this._inviteeTypes},this._calendar,a,this._person.id)},_drawTutorialEntry:function(a){return new seqta.coneqt.part.timetable.entry.Tutorial({inviteeTypes:this._inviteeTypes},this._calendar,a,this._person.id)},_navigate:function(a){"back"===a?this._date.addDays(-7):"forward"===a&&this._date.addDays(7),this._toolbarEls.date.set(new Date(this._date).startOfWeek().addDays(1),!0),this._retrieveData()},_changeDate:function(a){this._date=tools.parseDateString(a),this._retrieveData()},_createEntry:function(a){this._removeNewEntry(),this._entryID=a.calendarid,this._newEntry=new seqta.base.part.calendar.entry.New({entry:a,personID:this._person.id,personType:this._person.type,inviteeTypes:this._inviteeTypes},this._calendar,this._quickbar)},_removeNewEntry:function(){this._newEntry&&this._newEntry.remove()},_clickEntry:function(a){var b=!0;a.calendarid===this._entryID?this._quickbar.isVisible()&&(this._hideQuickbar(),b=!1):(this._removeNewEntry(),this._entryID=a.calendarid),b&&a.handler&&"function"===typeOf(a.handler.click)&&a.handler.click()},_dropEntry:function(a){a.entry.handler&&a.entry.handler.drop(a)},_showQuickbar:function(a,b,c,d){this._elQuickbar&&"function"==typeof this._elQuickbar.cleanup&&this._elQuickbar.cleanup(),this._elQuickbar=a,d=d||{code:this.options.defaultColour,obj:new Color(this.options.defaultColour)};var e=$(this._quickbar);e.empty(),a.toElement()&&e.grab(a),e.set("data-type",b),e.setStyle("background-color",d.code),e.set("data-yiq","#fff"===d.obj.yiqContrast()?"light":"dark"),this._quickbar.position(this._element,c),this._calendar.addEvent("scroll:pause",this._quickbar.reposition)},_showClassQuickbar:function(a){this._showQuickbar(new seqta.coneqt.part.timetable.quickbar.Class({mailToPrefix:this._mailtoPrefix},a.data,this._person.id),"class",a.element,{code:a.colour,obj:new Color(a.colour)})},_showEventQuickbar:function(a){this._showQuickbar(new seqta.base.part.calendar.quickbar.Event({showNotes:this._showNotes,showGutter:!0,canEditAll:!1,canEdit:a.data.event.owner_type===user.type&&a.data.event.owner_id===user.userID},a),"event",a.element,a.colour)},_hideQuickbar:function(){this._quickbar&&(this._quickbar.hide(),this._removeNewEntry(),this._calendar&&this._calendar.removeEvent("scroll:pause",this._quickbar.reposition))},_print:function(){ajax.print(this.options.urls.print,{date:new Date(this._date).startOfWeek().addDays(1).print("sqlDate"),student:this._person.id})}}),msg.register("chrome.ready",function(){dataStore.retrieve("siteSettings",function(a){for(var b=["coneqt-s.page.timetable","coneqt-p.page.timetable"],c=0;c<b.length;c++)if(a[b[c]]&&"disabled"===a[b[c]].value)return;seqta.chrome.registerPage("/timetable",seqta.coneqt.page.Timetable,{label:Locale.get("pages.timetable")})})},!0),seqta.coneqt.page.Welcome=new Class({Extends:seqta.coneqt.page.Portals,options:{urls:{load:"load/portals"}},Binds:["draw","getToolbar","_retrieveData","_receiveData","_render","_renderDefault"],_element:null,_joData:null,initialize:function(a){this.parent(a)},draw:function(){var a=seqta.chrome.getContentArea();a.getChildren().dispose(),this._element=new Element("div",{class:"welcome"}).inject(a),this._retrieveData()},_receiveData:function(a){a&&(a.contents||a.label||a.url)?(this._joData=a,this._render()):this._renderDefault()},_renderDefault:function(){new Element("div",{class:"defaultWelcomeWrapper",html:`<div class="defaultWelcome">\n\t\t\t\t<header>\n\t\t\t\t\t<h1>Welcome to SEQTA ${"student"===user.type?"Learn":"Engage"}!</h1>\n\t\t\t\t</header>\n\t\t\t\n\t\t\t\t<section class="navigation">\n\t\t\t\t\t<header>\n\t\t\t\t\t\t<h2>Getting around</h2>\n\t\t\t\t\t</header>\n\t\t\t\t\t<p>Use the menu on the left to navigate. If you're on a small screen, the menu hides automatically, but you can summon it using the menu button in the corner.</p>\n\t\t\t\t\t<p>Use the menu to explore and see what you can find. Note that your school may not be using all of the pages.</p>\n\t\t\t\t</section>\n\t\t\t\n\t\t\t\t<section class="dashboard">\n\t\t\t\t\t<header>\n\t\t\t\t\t\t<h2>Your dashboard</h2>\n\t\t\t\t\t</header>\n\t\t\t\t\t<p>The dashboard page includes dashlets which your school has enabled (and which you can't disable!), as well as optional dashlets that you can toggle on or off.</p>\n\t\t\t\t\t<p>Some dashlets help you to get organised, some give you key information, and some are just for fun.</p>\n\t\t\t\t</section>\n\t\t\t\n\t\t\t\t<section class="timetable">\n\t\t\t\t\t<header>\n\t\t\t\t\t\t<h2>Colour your timetable</h2>\n\t\t\t\t\t</header>\n\t\t\t\t\t<p>On the timetable page, tap (or click) on a class to access more details -- and then tap the palette button to colour up your timetable.</p>\n\t\t\t\t</section>\n\t\t\t</div>`}).inject(this._element)}}),msg.register("chrome.ready",function(){seqta.chrome.registerPage("/welcome",seqta.coneqt.page.Welcome,{label:Locale.get("pages.welcome"),order:1})},!0),seqta.coneqt.part.assessments.Wisp=new Class({Implements:[Options,Events],Binds:["toElement","_retrieveData","show","draw","selectTab","save","snapshot","_doSnapshot","_postSnapshot","toggleSubmit","getTextCount","autosave","doSave"],options:{urls:{load:"assessment/wisp/get",save:"assessment/submissions/save"},wispAutoSavePeriod:9e5},_element:null,_assessmentID:null,_joData:null,_files:null,_student:null,_metaclass:null,_elSubmitPanel:null,_elSubmitButton:null,_elSnapshotPanel:null,_elAnnotatedPanel:null,_elWispPreview:null,_elWispEditC:null,_wispAutoSave:null,_elTabSet:null,initialize:function(a){this.setOptions(a),this._element=new Element("div",{class:"wispassessment"})},_retrieveData:function(){ajax.send(this.options.urls.load,{student:this._student,metaclass:this._metaclass,assessment:this._assessmentID},function(a){this._files=a.files,this._joData=a,this.draw()}.bind(this))},show:function(a){let b=a.assessmentID,c=a.metaclassID,d=a.studentID;b&&c&&d&&(this._student=d,this._assessmentID=b,this._metaclass=c,this._element.getChildren().dispose(),this._retrieveData())},toElement:function(){return this._element},draw:function(){var a=[],b=!this._joData.locked&&(this._joData.upcoming&&!this._joData.annotated&&"student"===user.type&&!this._joData.marked||!this._joData.upcoming&&this._joData.postSubmissionAllowed);this._elWispPreview||(this._elWispPreview=new seqta.ui.Frame({autoSize:!1,annotator:{enabled:!0,readonly:!0},extraClass:"preview",macro:{browser:{fileDefaults:{type:"wisp"}}}},"",this._joData.files)),a.push(this._elWispPreview),this._elWispEditC&&this._elWispEditC.getChildren().destroy();var c=[{label:Locale.get("wispassessment.preview"),id:"preview",data:this._joData.submissions&&!b?this._joData.submissions.getLast():null}];if(this._joData.submissions)for(var d,e=1,f=0;f<this._joData.submissions.length;f++)(d=this._joData.submissions[f]).snapshot&&c.push({label:Locale.get("wispassessment.snapshot",e++),id:"snap-"+f,data:d});b&&(c.unshift({label:Locale.get("wispassessment.edit"),id:"edit"}),this._elWispEditC=new Element("div",{class:"edit"}),a.push(this._elWispEditC),$(this._elWispPreview).hide(),!this._elCountPanel&&(this._elCountPanel=new Element("div",{class:"count"})),this._elCountPanel.hide(),a.push(this._elCountPanel),!this._joData.postSubmissionAllowed&&(!this._elSubmitPanel&&(this._elSubmitPanel=new Element("div",{class:"actions submit"}),this._elSubmitButton=new seqta.ui.ButtonToggle({defaultValue:tools.getIcon("send"),onToggle:this.toggleSubmit}),this._elSubmitPanel.adopt(this._elSubmitButton,new Element("div",{class:"explanation",html:Locale.get("wispassessment.submitExplanation")}))),this._elSubmitPanel.hide(),a.push(this._elSubmitPanel),!this._elAnnotatedPanel&&(this._elAnnotatedPanel=new Element("div",{class:"actions annotated"}).adopt(new Element("div",{class:"imageCont",html:tools.getIcon("comment")}),new Element("div",{class:"explanation",html:Locale.get("wispassessment.annotatedExplanation")}))),this._elAnnotatedPanel.hide(),a.push(this._elAnnotatedPanel),!this._elSnapshotPanel&&(this._elSnapshotPanel=new Element("div",{class:"actions snapshot"}).adopt(new seqta.ui.Button({defaultValue:tools.getIcon("photo_camera"),onClick:this.snapshot}),new Element("div",{class:"explanation",html:Locale.get("wispassessment.snapshotExplanation")}))),this._elSnapshotPanel.show(),a.push(this._elSnapshotPanel))),this._elTabSet=new seqta.ui.TabSet({onChange:this.selectTab,alignment:"top"},c),a.unshift(this._elTabSet),!this._student&&this._joData.upcoming&&(this._joData.marked||this._joData.annotated)&&a.push(new Element("div",{class:"actions marked"}).adopt(new Element("div",{class:"imageCont",html:tools.getIcon("lock_outline")}),new Element("div",{class:"explanation",html:this._joData.marked?Locale.get("assessments.upcomingMarked"):Locale.get("assessments.upcomingAnnotated")}))),this._element.adopt(a),b?(this._elWispEditC.set("html",""),this._elTabSet.setSelected("edit"),this._joData.files.forEach(function(a){a.type="wisp"}),this._elWispEdit=new seqta.ui.FormattedText({allowedModes:{content:!0,html:!0,preview:!1},macro:{browser:{mode:"assessments",sources:[{enabled:!0,name:Locale.get("assessments.browser.assessments"),request:{mode:"assessments"}},{name:Locale.get("assessments.browser.folios"),request:{mode:"folios"}}],urls:{link:this.options.urls.save,remove:this.options.urls.save},fileDefaults:{type:"wisp"},files:this._joData.files,enableUpload:!0,linkParams:{action:"wisp-link",assID:this._assessmentID,metaclass:this._metaclass},remParams:{action:"wisp-unlink",assID:this._assessmentID,metaclass:this._metaclass}}}},this._joData.submissions&&this._joData.submissions.length?this._joData.submissions.getLast().contents:""),this._elWispEditC.grab(this._elWispEdit),this._elWispEdit.ready(),this._wispAutoSave=this.autosave.periodical(this.options.wispAutoSavePeriod)):this._elTabSet.setSelected("preview"),new seqta.ui.SlidePane({onSave:b?this.save:null,extraClass:"tall"}).show(Locale.get("wispassessment.manageWisp"),$(this._element),[b?"save":"close"])},selectTab:function(a){this._elSnapshotPanel&&this._elSnapshotPanel.hide(),this._elSubmitPanel&&this._elSubmitPanel.hide(),this._elAnnotatedPanel&&this._elAnnotatedPanel.hide(),this._elCountPanel&&this._elCountPanel.hide();var b="";if("edit"===a.id)this._elWispEditC.show(),this._elWispPreview&&$(this._elWispPreview).hide(),this._elSnapshotPanel&&this._elSnapshotPanel.show();else{if(this._elWispEdit&&this._elWispPreview.setFiles(this._elWispEdit.getFiles()||this._files),a.data)this._elWispPreview.replaceContent(a.data.contents),b=a.data.contents,a.data.annotations?(this._elAnnotatedPanel&&this._elAnnotatedPanel.show(),this._elWispPreview.setAnnotations(a.data.annotations)):(this._elSubmitPanel&&this._elSubmitPanel.show(),this._elSubmitButton&&this._elSubmitButton.setToggled(!!a.data.submitted),this._elWispPreview.setAnnotations({}));else if(this._elWispEdit){this._elWispPreview.replaceContent(this._elWispEdit.get()),b=this._elWispEdit.get();this._elWispEdit.getFiles()||this._files,this._elWispEdit.get();this._elSnapshotPanel&&this._elSnapshotPanel.show()}this._elCountPanel&&(this._elCountPanel.show(),this._elCountPanel.set("text",this.getTextCounts(b))),$(this._elWispPreview).show(),this._elWispEditC&&this._elWispEditC.hide()}},save:function(){this._wispAutoSave&&(window.clearInterval(this._wispAutoSave),this._wispAutoSave=null),this.doSave()},snapshot:function(){this.doSave(this._doSnapshot)},_doSnapshot:function(){ajax.send(this.options.urls.save,{action:"wisp-snapshot",assID:this._assessmentID,metaclass:this._metaclass},this._postSnapshot)},_postSnapshot:function(a){var b=$(this._elTabSet),c=this._elTabSet.data,d=c.length-2;c.push({label:Locale.get("wispassessment.snapshot",d+1),id:"snap-"+d,data:a}),this._elTabSet=new seqta.ui.TabSet({onChange:this.selectTab,alignment:"top"},c),this._elTabSet.setSelected("snap-"+d),$(this._elTabSet).replaces(b)},toggleSubmit:function(a){var b=this._elTabSet.getSelected();if(b){var c=b.data;c.snapshot&&ajax.send(this.options.urls.save,{submitted:!!a,action:"wisp-toggle",id:c.id,assID:this._assessmentID,metaclass:this._metaclass})}},getTextCounts:function(a){var b=a.textFromHTML().trim(),c=b?b.split(/\s+/).length:0;return"Text count: "+Locale.get("wispassessment.wordCount",[c,b.length])},autosave:function(){this.doSave()},doSave:function(a){var b={action:"wisp",assID:this._assessmentID,metaclass:this._metaclass,contents:this._elWispEdit&&this._elWispEdit.get()&&!this._elWispEdit.get().isBlankHTML()?this._elWispEdit.get():""};ajax.send(this.options.urls.save,b,function(){if(this.fireEvent("save"),a&&"function"===typeOf(a))a();else{const a={hasContent:!!b.contents,numberSnapshots:this._elTabSet.data.length-2};msg.send("wispassessment.updateStats",[a])}}.bind(this))}}),seqta.coneqt.part.timetable=seqta.coneqt.part.timetable||{},seqta.coneqt.part.timetable.entry=seqta.coneqt.part.timetable.entry||{},seqta.coneqt.part.timetable.entry.Class=new Class({Implements:[Options,Events],Binds:["cleanup","draw","_createEntry","_getPrefColour","_updatePrefColour","click"],options:{defaultColour:"#dddddd"},_calendar:null,_data:null,_element:null,_cleaner:null,_entry:null,initialize:function(a,b,c,d){this.setOptions(a),this._data=c,this._calendar=b,this._student=d,this._cleaner=msg.register("timetable.subject.colour."+("student"===user.type?"":d+".")+c.code,this._updatePrefColour),msg.send("calendar.cleaner",this.cleanup),this.draw()},cleanup:function(){"function"==typeof this._cleaner&&(this._cleaner(),this._cleaner=null)},draw:function(a){this._entry=this._createEntry(this._data,this._getPrefColour(this._data.code),this),a?(this._entry.calendarid=a,this._element=this._calendar.updateEntry(this._entry)):this._element=this._calendar.addEntry(this._entry),this._element&&this._element.set("data-instance",this._data.ci)},_createEntry:function(a,b,c){var d={calendarid:a.calendarid||String.uniqueID(),id:a.ci+"|"+(a.programmeID||""),type:a.type,date:a.date,from:a.from,until:a.until,handler:c,title:a.description,colour:b.code};return d.extraElements=a.assessments&&a.assessments.length?[new Element("div",{class:"assessment",title:Locale.get("timetable.assessmentDue",a.assessments[0].title),html:tools.getIcon("assessments")})]:[],d.extraElements.push(new Element("div",{class:"teacher",text:a.staff||""})),d.extraElements.push(new Element("div",{class:"room"+(a.room_changed?" changed":""),text:a.room_changed?"("+a.room+")":a.room||""})),d.extraClass=a.type,a.assessments&&a.assessments.length&&(d.extraClass+=" assessment"),a.approved&&(d.extraClass+=" approved"),d},_getPrefColour:function(a){var b;return{code:b=(b=(b=user.getPreference("timetable.subject.colour."+("student"===user.type?"":this._student+".")+a))&&b.value)||this.options.defaultColour,obj:new Color(b)}},_updatePrefColour:function(a){this._entry.colour=a,this._calendar.updateEntry(this._entry)},click:function(){msg.send("calendar.quickbar.class",{colour:this._entry.colour||this.options.defaultColour,data:this._data,element:this._element})}}),seqta.coneqt.part.timetable=seqta.coneqt.part.timetable||{},seqta.coneqt.part.timetable.entry=seqta.coneqt.part.timetable.entry||{},seqta.coneqt.part.timetable.entry.Tutorial=new Class({Implements:[Options,Events],Binds:["cleanup","draw","_createEntry","_getPrefColour","_updatePrefColour","click"],options:{defaultColour:"#dddddd"},_calendar:null,_data:null,_element:null,_cleaner:null,_entry:null,initialize:function(a,b,c,d){this.setOptions(a),this._data=c,this._calendar=b,this._student=d,this._cleaner=msg.register("timetable.tutor."+c.tutorID,this._updatePrefColour),msg.send("calendar.cleaner",this.cleanup),this.draw()},cleanup:function(){"function"==typeof this._cleaner&&(this._cleaner(),this._cleaner=null)},draw:function(a){this._entry=this._createEntry(this._data,this._getPrefColour(this._data.tutorID),this),a?(this._entry.calendarid=a,this._element=this._calendar.updateEntry(this._entry)):this._element=this._calendar.addEntry(this._entry),this._element&&this._element.set("data-instance",this._data.ci)},_createEntry:function(a,b,c){var d={calendarid:a.calendarid||String.uniqueID(),id:a.id+"|"+(a.tutorID||""),description:Locale.get("timetable.tutorial",a.tutorial_type),type:a.type,date:a.date,from:a.from,until:a.until,handler:c,title:a.description,colour:b.code};return a.approved||(a.title+=" "+Locale.get("timetable.tutorialPending")),d.extraElements=[new Element("div",{class:"teacher",text:a.staff||""}),new Element("div",{class:"room"+(a.room_changed?" changed":""),text:a.room_changed?"("+a.room+")":a.room||""})],d.extraClass=a.type,a.assessments&&a.assessments.length&&(d.extraClass+=" assessment"),a.approved&&(d.extraClass+=" approved"),d},_getPrefColour:function(a){var b;return{code:b=(b=(b=user.getPreference("timetable.tutor."+a))&&b.value)||this.options.defaultColour,obj:new Color(b)}},_updatePrefColour:function(a){this._entry.colour=a,this._calendar.updateEntry(this._entry)},click:function(){msg.send("calendar.quickbar.class",{colour:this._entry.colour||this.options.defaultColour,data:this._data,element:this._element})}}),seqta.coneqt.part.timetable=seqta.coneqt.part.timetable||{},seqta.coneqt.part.timetable.quickbar=seqta.coneqt.part.timetable.quickbar||{},seqta.coneqt.part.timetable.quickbar.Class=new Class({Implements:[Options,Events],Binds:["toElement","draw","_createElements","_createMetaElements","_createActionElements","_selectColour","_selectedColour","_sendMessage","_teamsClass","_receiveData"],options:{mailToPrefix:null},_element:null,_elements:null,_data:null,_studentID:null,initialize:function(a,b,c){this.setOptions(a),this._data=b,this._studentID=c,this._element=new Element("div",{class:"wrapper"}),this.draw()},toElement:function(){return this._element},draw:function(){this._elements=this._createElements(this._data),this._element.adopt(this._elements.title,this._elements.meta.container,this._elements.actions.container,this._elements.attendance)},_createElements:function(a){var b={title:new Element("div",{class:"title",text:a.description||""}),meta:this._createMetaElements(a),actions:this._createActionElements(a)};return a.attendance&&(b.attendance=new Element("div",{class:"attendance",html:tools.getIcon(a.attendance.icon,null,a.attendance.label,null,null,a.attendance.label),title:a.attendance.label})),b},_createMetaElements:function(a){var b={times:new Element("div",{class:"times",html:a.from.toDate().print("H:i")+"&ndash;"+a.until.toDate().print("H:i")}),period:new Element("div",{class:"period",text:a.period||""}),container:new Element("div",{class:"meta"})};return a.room&&(b.room=new Element("div",{class:"room"+(a.room_changed?" changed":""),text:a.room_changed?"("+a.room+")":a.room||""})),a.staff&&(b.staff=new Element("div",{class:"teacher",text:a.staff})),a.details&&0<a.details.trim().length&&(b.details=new Element("div",{class:"details",text:a.details})),a.assessments&&a.assessments.length&&(b.assessments=a.assessments.map(function(a){return new Element("div",{class:"assessment",html:tools.getIcon("assessments")+Locale.get("timetable.assessment",[a.title,a.due?a.due.toDate().print():""])})})),b.container.adopt(b.times,b.period,b.room,b.staff,b.details,b.assessments),b},_createActionElements:function(a){var b={colours:new seqta.ui.Button({defaultValue:tools.getIcon("palette"),title:Locale.get("general.colour"),onClick:this._selectColour}),container:new Element("div",{class:"actions"})};a.staffID&&(b.message=new seqta.ui.Button({defaultValue:tools.getIcon("direqt_message"),extraClass:"direqtmessage",title:Locale.get("timetable.message"),onClick:this._sendMessage})),a.staffEmail&&(b.email=new Element("a",{html:tools.getIcon("mail_outline"),href:this.options.mailToPrefix+a.staffEmail,target:"_blank"}));var c=this._data||{};const d=c.teamSync,e=c.teamId;let f,g;if(dataStore.has("siteSettings")){const a=dataStore.retrieve("siteSettings");f=a.hasOwnProperty("global.microsoftTeams.applicationId")&&a.hasOwnProperty("global.microsoftTeams.clientSecret")&&a.hasOwnProperty("global.microsoftTeams.directoryId")&&a.hasOwnProperty("global.microsoftTeams.features"),g=d&&e&&a["global.microsoftTeams.features"]&&"enabled"===a["global.microsoftTeams.features"].value}return f&&g&&"student"===user.type&&(b.teams=new seqta.ui.Button({extraClass:"teams",defaultValue:tools.getIcon("microsoft_teams"),title:Locale.get("timetable.launchMicrosoftTeams"),onClick:this._teamsClass})),b.container.adopt(b.teams,b.colours,b.message,b.email),b},_selectColour:function(){this._colourChooser=this._colourChooser||new seqta.ui.ColourChooser({slide:!0,onAccept:this._selectedColour}),this._colourChooser.show(this._data.colour||null)},_selectedColour:function(a){var b=this._data.code,c=this._data.tutorID,d=null;"class"===this._data.type?d="timetable.subject.colour."+("student"===user.type?"":this._studentID+".")+b:"tutorial"===this._data.type&&(d="timetable.tutor."+c),user.savePreference(d,a),msg.send(d,a),msg.send("menu.update.colours");var e=this._element.getParent();e&&(e.setStyle("background-color",a),e.set("data-yiq","#fff"===new Color(a).yiqContrast()?"light":"dark"))},_sendMessage:function(){msg.send("coneqtmessage.global.compose",{staff:this._data.staffID})},_receiveData:function(a){const b=a.webURL;window.open(b)},_teamsClass:function(){const b=(this._data||{}).teamId;b&&ajax.send("teams/TeamWebUrl/get",{teamUUID:b},this._receiveData)}}),seqta.coneqt.ThemeBrowser=new Class({Implements:[Options,Events],Extends:seqta.base.ComponentWrapper,Binds:["enable"],options:{},initialize:function(a){this.setOptions(a),this.parent({component:SEQTATeachModules.composer.ThemeBrowser,className:"uiThemeBrowser",props:a})},enable:function(a){a?this.toElement().removeClass("disabled"):this.toElement().addClass("disabled")}});